import*as g from"https://unpkg.com/three@0.152.2/build/three.module.js";import{GLTFLoader as Lt}from"https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js";import{EffectComposer as Ae}from"https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as Te}from"https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as De}from"https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/UnrealBloomPass.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const we="160",Me=300,$t=1e3,Ct=1001,Zt=1002,Jt=1003,Le=1006,Ie=1008,Fe=1009,Pe=1014,Re=1020,Be=1023,It=1026,Qt=1027,Oe=3e3,Ft=3001,Pt="",Rt="srgb",Ne=515,St=2e3,Kt=2001;class Vt{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const n=i.slice(0);for(let s=0,r=n.length;s<r;s++)n[s].call(this,t);t.target=null}}}const E=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Yt(){const d=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(E[d&255]+E[d>>8&255]+E[d>>16&255]+E[d>>24&255]+"-"+E[t&255]+E[t>>8&255]+"-"+E[t>>16&15|64]+E[t>>24&255]+"-"+E[e&63|128]+E[e>>8&255]+"-"+E[e>>16&255]+E[e>>24&255]+E[i&255]+E[i>>8&255]+E[i>>16&255]+E[i>>24&255]).toLowerCase()}function q(d,t,e){return Math.max(t,Math.min(e,d))}class yt{constructor(t=0,e=0){yt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(q(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xt{constructor(t,e,i,n,s,r,o,a,h){xt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,n,s,r,o,a,h)}set(t,e,i,n,s,r,o,a,h){const l=this.elements;return l[0]=t,l[1]=n,l[2]=o,l[3]=e,l[4]=s,l[5]=a,l[6]=i,l[7]=r,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[3],a=i[6],h=i[1],l=i[4],c=i[7],m=i[2],u=i[5],p=i[8],y=n[0],x=n[3],f=n[6],C=n[1],S=n[4],b=n[7],M=n[2],_=n[5],w=n[8];return s[0]=r*y+o*C+a*M,s[3]=r*x+o*S+a*_,s[6]=r*f+o*b+a*w,s[1]=h*y+l*C+c*M,s[4]=h*x+l*S+c*_,s[7]=h*f+l*b+c*w,s[2]=m*y+u*C+p*M,s[5]=m*x+u*S+p*_,s[8]=m*f+u*b+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*r*l-e*o*h-i*s*l+i*o*a+n*s*h-n*r*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=l*r-o*h,m=o*a-l*s,u=h*s-r*a,p=e*c+i*m+n*u;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/p;return t[0]=c*y,t[1]=(n*h-l*i)*y,t[2]=(o*i-n*r)*y,t[3]=m*y,t[4]=(l*e-n*a)*y,t[5]=(n*s-o*e)*y,t[6]=u*y,t[7]=(i*a-h*e)*y,t[8]=(r*e-i*s)*y,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,r,o){const a=Math.cos(s),h=Math.sin(s);return this.set(i*a,i*h,-i*(a*r+h*o)+r+t,-n*h,n*a,-n*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Bt.makeScale(t,e)),this}rotate(t){return this.premultiply(Bt.makeRotation(-t)),this}translate(t,e){return this.premultiply(Bt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Bt=new xt;function te(d){return document.createElementNS("http://www.w3.org/1999/xhtml",d)}const ee={};function Ot(d){d in ee||(ee[d]=!0,console.warn(d))}function Nt(d){return d<.04045?d*.0773993808:Math.pow(d*.9478672986+.0521327014,2.4)}let rt;class Ue{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{rt===void 0&&(rt=te("canvas")),rt.width=t.width,rt.height=t.height;const i=rt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=rt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=te("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let r=0;r<s.length;r++)s[r]=Nt(s[r]/255)*255;return i.putImageData(n,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Nt(e[i]/255)*255):e[i]=Nt(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let He=0;class We{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:He++}),this.uuid=Yt(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let r=0,o=n.length;r<o;r++)n[r].isDataTexture?s.push(Ut(n[r].image)):s.push(Ut(n[r]))}else s=Ut(n);i.url=s}return e||(t.images[this.uuid]=i),i}}function Ut(d){return typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&d instanceof ImageBitmap?Ue.getDataURL(d):d.data?{data:Array.from(d.data),width:d.width,height:d.height,type:d.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let je=0;class Q extends Vt{constructor(t=Q.DEFAULT_IMAGE,e=Q.DEFAULT_MAPPING,i=Ct,n=Ct,s=Le,r=Ie,o=Be,a=Fe,h=Q.DEFAULT_ANISOTROPY,l=Pt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:je++}),this.uuid=Yt(),this.name="",this.source=new We(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new yt(0,0),this.repeat=new yt(1,1),this.center=new yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof l=="string"?this.colorSpace=l:(Ot("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=l===Ft?Rt:Pt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Me)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case $t:t.x=t.x-Math.floor(t.x);break;case Ct:t.x=t.x<0?0:1;break;case Zt:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case $t:t.y=t.y-Math.floor(t.y);break;case Ct:t.y=t.y<0?0:1;break;case Zt:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Ot("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Rt?Ft:Oe}set encoding(t){Ot("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Ft?Rt:Pt}}Q.DEFAULT_IMAGE=null;Q.DEFAULT_MAPPING=Me;Q.DEFAULT_ANISOTROPY=1;class wt{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,s,r,o){let a=i[n+0],h=i[n+1],l=i[n+2],c=i[n+3];const m=s[r+0],u=s[r+1],p=s[r+2],y=s[r+3];if(o===0){t[e+0]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c;return}if(o===1){t[e+0]=m,t[e+1]=u,t[e+2]=p,t[e+3]=y;return}if(c!==y||a!==m||h!==u||l!==p){let x=1-o;const f=a*m+h*u+l*p+c*y,C=f>=0?1:-1,S=1-f*f;if(S>Number.EPSILON){const M=Math.sqrt(S),_=Math.atan2(M,f*C);x=Math.sin(x*_)/M,o=Math.sin(o*_)/M}const b=o*C;if(a=a*x+m*b,h=h*x+u*b,l=l*x+p*b,c=c*x+y*b,x===1-o){const M=1/Math.sqrt(a*a+h*h+l*l+c*c);a*=M,h*=M,l*=M,c*=M}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,s,r){const o=i[n],a=i[n+1],h=i[n+2],l=i[n+3],c=s[r],m=s[r+1],u=s[r+2],p=s[r+3];return t[e]=o*p+l*c+a*u-h*m,t[e+1]=a*p+l*m+h*c-o*u,t[e+2]=h*p+l*u+o*m-a*c,t[e+3]=l*p-o*c-a*m-h*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,n=t._y,s=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(i/2),l=o(n/2),c=o(s/2),m=a(i/2),u=a(n/2),p=a(s/2);switch(r){case"XYZ":this._x=m*l*c+h*u*p,this._y=h*u*c-m*l*p,this._z=h*l*p+m*u*c,this._w=h*l*c-m*u*p;break;case"YXZ":this._x=m*l*c+h*u*p,this._y=h*u*c-m*l*p,this._z=h*l*p-m*u*c,this._w=h*l*c+m*u*p;break;case"ZXY":this._x=m*l*c-h*u*p,this._y=h*u*c+m*l*p,this._z=h*l*p+m*u*c,this._w=h*l*c-m*u*p;break;case"ZYX":this._x=m*l*c-h*u*p,this._y=h*u*c+m*l*p,this._z=h*l*p-m*u*c,this._w=h*l*c+m*u*p;break;case"YZX":this._x=m*l*c+h*u*p,this._y=h*u*c+m*l*p,this._z=h*l*p-m*u*c,this._w=h*l*c-m*u*p;break;case"XZY":this._x=m*l*c-h*u*p,this._y=h*u*c-m*l*p,this._z=h*l*p+m*u*c,this._w=h*l*c+m*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],o=e[5],a=e[9],h=e[2],l=e[6],c=e[10],m=i+o+c;if(m>0){const u=.5/Math.sqrt(m+1);this._w=.25/u,this._x=(l-a)*u,this._y=(s-h)*u,this._z=(r-n)*u}else if(i>o&&i>c){const u=2*Math.sqrt(1+i-o-c);this._w=(l-a)/u,this._x=.25*u,this._y=(n+r)/u,this._z=(s+h)/u}else if(o>c){const u=2*Math.sqrt(1+o-i-c);this._w=(s-h)/u,this._x=(n+r)/u,this._y=.25*u,this._z=(a+l)/u}else{const u=2*Math.sqrt(1+c-i-o);this._w=(r-n)/u,this._x=(s+h)/u,this._y=(a+l)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(q(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,r=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=i*l+r*o+n*h-s*a,this._y=n*l+r*a+s*o-i*h,this._z=s*l+r*h+i*a-n*o,this._w=r*l-i*o-n*a-s*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,n=this._y,s=this._z,r=this._w;let o=r*t._w+i*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const u=1-e;return this._w=u*r+e*this._w,this._x=u*i+e*this._x,this._y=u*n+e*this._y,this._z=u*s+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),c=Math.sin((1-e)*l)/h,m=Math.sin(e*l)/h;return this._w=r*c+this._w*m,this._x=i*c+this._x*m,this._y=n*c+this._y*m,this._z=s*c+this._z*m,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class z{constructor(t=0,e=0,i=0){z.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ie.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ie.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*n-o*i),l=2*(o*e-s*n),c=2*(s*i-r*e);return this.x=e+a*h+r*c-o*l,this.y=i+a*l+o*h-s*c,this.z=n+a*c+s*l-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Ht.copy(this).projectOnVector(t),this.sub(Ht)}reflect(t){return this.sub(Ht.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(q(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ht=new z,ie=new wt;class Y{constructor(t,e,i,n,s,r,o,a,h,l,c,m,u,p,y,x){Y.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,n,s,r,o,a,h,l,c,m,u,p,y,x)}set(t,e,i,n,s,r,o,a,h,l,c,m,u,p,y,x){const f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=n,f[1]=s,f[5]=r,f[9]=o,f[13]=a,f[2]=h,f[6]=l,f[10]=c,f[14]=m,f[3]=u,f[7]=p,f[11]=y,f[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Y().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/at.setFromMatrixColumn(t,0).length(),s=1/at.setFromMatrixColumn(t,1).length(),r=1/at.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(n),h=Math.sin(n),l=Math.cos(s),c=Math.sin(s);if(t.order==="XYZ"){const m=r*l,u=r*c,p=o*l,y=o*c;e[0]=a*l,e[4]=-a*c,e[8]=h,e[1]=u+p*h,e[5]=m-y*h,e[9]=-o*a,e[2]=y-m*h,e[6]=p+u*h,e[10]=r*a}else if(t.order==="YXZ"){const m=a*l,u=a*c,p=h*l,y=h*c;e[0]=m+y*o,e[4]=p*o-u,e[8]=r*h,e[1]=r*c,e[5]=r*l,e[9]=-o,e[2]=u*o-p,e[6]=y+m*o,e[10]=r*a}else if(t.order==="ZXY"){const m=a*l,u=a*c,p=h*l,y=h*c;e[0]=m-y*o,e[4]=-r*c,e[8]=p+u*o,e[1]=u+p*o,e[5]=r*l,e[9]=y-m*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if(t.order==="ZYX"){const m=r*l,u=r*c,p=o*l,y=o*c;e[0]=a*l,e[4]=p*h-u,e[8]=m*h+y,e[1]=a*c,e[5]=y*h+m,e[9]=u*h-p,e[2]=-h,e[6]=o*a,e[10]=r*a}else if(t.order==="YZX"){const m=r*a,u=r*h,p=o*a,y=o*h;e[0]=a*l,e[4]=y-m*c,e[8]=p*c+u,e[1]=c,e[5]=r*l,e[9]=-o*l,e[2]=-h*l,e[6]=u*c+p,e[10]=m-y*c}else if(t.order==="XZY"){const m=r*a,u=r*h,p=o*a,y=o*h;e[0]=a*l,e[4]=-c,e[8]=h*l,e[1]=m*c+y,e[5]=r*l,e[9]=u*c-p,e[2]=p*c-u,e[6]=o*l,e[10]=y*c+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ge,t,qe)}lookAt(t,e,i){const n=this.elements;return F.subVectors(t,e),F.lengthSq()===0&&(F.z=1),F.normalize(),Z.crossVectors(i,F),Z.lengthSq()===0&&(Math.abs(i.z)===1?F.x+=1e-4:F.z+=1e-4,F.normalize(),Z.crossVectors(i,F)),Z.normalize(),kt.crossVectors(F,Z),n[0]=Z.x,n[4]=kt.x,n[8]=F.x,n[1]=Z.y,n[5]=kt.y,n[9]=F.y,n[2]=Z.z,n[6]=kt.z,n[10]=F.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[4],a=i[8],h=i[12],l=i[1],c=i[5],m=i[9],u=i[13],p=i[2],y=i[6],x=i[10],f=i[14],C=i[3],S=i[7],b=i[11],M=i[15],_=n[0],w=n[4],H=n[8],W=n[12],P=n[1],v=n[5],N=n[9],$=n[13],K=n[2],tt=n[6],et=n[10],it=n[14],nt=n[3],I=n[7],bt=n[11],_t=n[15];return s[0]=r*_+o*P+a*K+h*nt,s[4]=r*w+o*v+a*tt+h*I,s[8]=r*H+o*N+a*et+h*bt,s[12]=r*W+o*$+a*it+h*_t,s[1]=l*_+c*P+m*K+u*nt,s[5]=l*w+c*v+m*tt+u*I,s[9]=l*H+c*N+m*et+u*bt,s[13]=l*W+c*$+m*it+u*_t,s[2]=p*_+y*P+x*K+f*nt,s[6]=p*w+y*v+x*tt+f*I,s[10]=p*H+y*N+x*et+f*bt,s[14]=p*W+y*$+x*it+f*_t,s[3]=C*_+S*P+b*K+M*nt,s[7]=C*w+S*v+b*tt+M*I,s[11]=C*H+S*N+b*et+M*bt,s[15]=C*W+S*$+b*it+M*_t,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],o=t[5],a=t[9],h=t[13],l=t[2],c=t[6],m=t[10],u=t[14],p=t[3],y=t[7],x=t[11],f=t[15];return p*(+s*a*c-n*h*c-s*o*m+i*h*m+n*o*u-i*a*u)+y*(+e*a*u-e*h*m+s*r*m-n*r*u+n*h*l-s*a*l)+x*(+e*h*c-e*o*u-s*r*c+i*r*u+s*o*l-i*h*l)+f*(-n*o*l-e*a*c+e*o*m+n*r*c-i*r*m+i*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=t[9],m=t[10],u=t[11],p=t[12],y=t[13],x=t[14],f=t[15],C=c*x*h-y*m*h+y*a*u-o*x*u-c*a*f+o*m*f,S=p*m*h-l*x*h-p*a*u+r*x*u+l*a*f-r*m*f,b=l*y*h-p*c*h+p*o*u-r*y*u-l*o*f+r*c*f,M=p*c*a-l*y*a-p*o*m+r*y*m+l*o*x-r*c*x,_=e*C+i*S+n*b+s*M;if(_===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=C*w,t[1]=(y*m*s-c*x*s-y*n*u+i*x*u+c*n*f-i*m*f)*w,t[2]=(o*x*s-y*a*s+y*n*h-i*x*h-o*n*f+i*a*f)*w,t[3]=(c*a*s-o*m*s-c*n*h+i*m*h+o*n*u-i*a*u)*w,t[4]=S*w,t[5]=(l*x*s-p*m*s+p*n*u-e*x*u-l*n*f+e*m*f)*w,t[6]=(p*a*s-r*x*s-p*n*h+e*x*h+r*n*f-e*a*f)*w,t[7]=(r*m*s-l*a*s+l*n*h-e*m*h-r*n*u+e*a*u)*w,t[8]=b*w,t[9]=(p*c*s-l*y*s-p*i*u+e*y*u+l*i*f-e*c*f)*w,t[10]=(r*y*s-p*o*s+p*i*h-e*y*h-r*i*f+e*o*f)*w,t[11]=(l*o*s-r*c*s-l*i*h+e*c*h+r*i*u-e*o*u)*w,t[12]=M*w,t[13]=(l*y*n-p*c*n+p*i*m-e*y*m-l*i*x+e*c*x)*w,t[14]=(p*o*n-r*y*n-p*i*a+e*y*a+r*i*x-e*o*x)*w,t[15]=(r*c*n-l*o*n+l*i*a-e*c*a-r*i*m+e*o*m)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,o=t.y,a=t.z,h=s*r,l=s*o;return this.set(h*r+i,h*o-n*a,h*a+n*o,0,h*o+n*a,l*o+i,l*a-n*r,0,h*a-n*o,l*a+n*r,s*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,r){return this.set(1,i,s,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,r=e._y,o=e._z,a=e._w,h=s+s,l=r+r,c=o+o,m=s*h,u=s*l,p=s*c,y=r*l,x=r*c,f=o*c,C=a*h,S=a*l,b=a*c,M=i.x,_=i.y,w=i.z;return n[0]=(1-(y+f))*M,n[1]=(u+b)*M,n[2]=(p-S)*M,n[3]=0,n[4]=(u-b)*_,n[5]=(1-(m+f))*_,n[6]=(x+C)*_,n[7]=0,n[8]=(p+S)*w,n[9]=(x-C)*w,n[10]=(1-(m+y))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=at.set(n[0],n[1],n[2]).length();const r=at.set(n[4],n[5],n[6]).length(),o=at.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],R.copy(this);const h=1/s,l=1/r,c=1/o;return R.elements[0]*=h,R.elements[1]*=h,R.elements[2]*=h,R.elements[4]*=l,R.elements[5]*=l,R.elements[6]*=l,R.elements[8]*=c,R.elements[9]*=c,R.elements[10]*=c,e.setFromRotationMatrix(R),i.x=s,i.y=r,i.z=o,this}makePerspective(t,e,i,n,s,r,o=St){const a=this.elements,h=2*s/(e-t),l=2*s/(i-n),c=(e+t)/(e-t),m=(i+n)/(i-n);let u,p;if(o===St)u=-(r+s)/(r-s),p=-2*r*s/(r-s);else if(o===Kt)u=-r/(r-s),p=-r*s/(r-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return a[0]=h,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=m,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,s,r,o=St){const a=this.elements,h=1/(e-t),l=1/(i-n),c=1/(r-s),m=(e+t)*h,u=(i+n)*l;let p,y;if(o===St)p=(r+s)*c,y=-2*c;else if(o===Kt)p=s*c,y=-1*c;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-m,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=y,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const at=new z,R=new Y,Ge=new z(0,0,0),qe=new z(1,1,1),Z=new z,kt=new z,F=new z,ne=new Y,se=new wt;class Mt{constructor(t=0,e=0,i=0,n=Mt.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],r=n[4],o=n[8],a=n[1],h=n[5],l=n[9],c=n[2],m=n[6],u=n[10];switch(e){case"XYZ":this._y=Math.asin(q(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,u),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(m,h),this._z=0);break;case"YXZ":this._x=Math.asin(-q(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(q(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-q(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(m,u),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(q(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-q(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(m,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-l,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ne.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ne,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return se.setFromEuler(this),this.setFromQuaternion(se,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Mt.DEFAULT_ORDER="XYZ";class Ve{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Ye=0;const oe=new z,ht=new wt,j=new Y,zt=new z,ut=new z,Xe=new z,$e=new wt,re=new z(1,0,0),ae=new z(0,1,0),he=new z(0,0,1),Ze={type:"added"},Je={type:"removed"};class st extends Vt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ye++}),this.uuid=Yt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=st.DEFAULT_UP.clone();const t=new z,e=new Mt,i=new wt,n=new z(1,1,1);function s(){i.setFromEuler(e,!1)}function r(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Y},normalMatrix:{value:new xt}}),this.matrix=new Y,this.matrixWorld=new Y,this.matrixAutoUpdate=st.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=st.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ve,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ht.setFromAxisAngle(t,e),this.quaternion.multiply(ht),this}rotateOnWorldAxis(t,e){return ht.setFromAxisAngle(t,e),this.quaternion.premultiply(ht),this}rotateX(t){return this.rotateOnAxis(re,t)}rotateY(t){return this.rotateOnAxis(ae,t)}rotateZ(t){return this.rotateOnAxis(he,t)}translateOnAxis(t,e){return oe.copy(t).applyQuaternion(this.quaternion),this.position.add(oe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(re,t)}translateY(t){return this.translateOnAxis(ae,t)}translateZ(t){return this.translateOnAxis(he,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(j.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?zt.copy(t):zt.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),ut.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?j.lookAt(ut,zt,this.up):j.lookAt(zt,ut,this.up),this.quaternion.setFromRotationMatrix(j),n&&(j.extractRotation(n.matrixWorld),ht.setFromRotationMatrix(j),this.quaternion.premultiply(ht.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ze)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Je)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),j.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),j.multiply(t.parent.matrixWorld)),t.applyMatrix4(j),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const r=this.children[i].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const n=this.children;for(let s=0,r=n.length;s<r;s++)n[s].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ut,t,Xe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ut,$e,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const s=e[i];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const n=this.children;for(let s=0,r=n.length;s<r;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(t)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const a=o.shapes;if(Array.isArray(a))for(let h=0,l=a.length;h<l;h++){const c=a[h];s(t.shapes,c)}else s(t.shapes,a)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let a=0,h=this.material.length;a<h;a++)o.push(s(t.materials,this.material[a]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const a=this.animations[o];n.animations.push(s(t.animations,a))}}if(e){const o=r(t.geometries),a=r(t.materials),h=r(t.textures),l=r(t.images),c=r(t.shapes),m=r(t.skeletons),u=r(t.animations),p=r(t.nodes);o.length>0&&(i.geometries=o),a.length>0&&(i.materials=a),h.length>0&&(i.textures=h),l.length>0&&(i.images=l),c.length>0&&(i.shapes=c),m.length>0&&(i.skeletons=m),u.length>0&&(i.animations=u),p.length>0&&(i.nodes=p)}return i.object=n,i;function r(o){const a=[];for(const h in o){const l=o[h];delete l.metadata,a.push(l)}return a}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const n=t.children[i];this.add(n.clone())}return this}}st.DEFAULT_UP=new z(0,1,0);st.DEFAULT_MATRIX_AUTO_UPDATE=!0;st.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class Qe extends Q{constructor(t,e,i,n,s,r,o,a,h,l){if(l=l!==void 0?l:It,l!==It&&l!==Qt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&l===It&&(i=Pe),i===void 0&&l===Qt&&(i=Re),super(null,n,s,r,o,a,l,i,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:Jt,this.minFilter=a!==void 0?a:Jt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Ke=new Qe(1,1);Ke.compareFunction=Ne;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:we}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=we);const lt=new Mt(0,0,0,"YXZ"),ct=new z,ti={type:"change"},ei={type:"lock"},ii={type:"unlock"},le=Math.PI/2;class ni extends Vt{constructor(t,e){super(),this.camera=t,this.domElement=e,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=si.bind(this),this._onPointerlockChange=oi.bind(this),this._onPointerlockError=ri.bind(this),this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return this.camera}getDirection(t){return t.set(0,0,-1).applyQuaternion(this.camera.quaternion)}moveForward(t){const e=this.camera;ct.setFromMatrixColumn(e.matrix,0),ct.crossVectors(e.up,ct),e.position.addScaledVector(ct,t)}moveRight(t){const e=this.camera;ct.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(ct,t)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function si(d){if(this.isLocked===!1)return;const t=d.movementX||d.mozMovementX||d.webkitMovementX||0,e=d.movementY||d.mozMovementY||d.webkitMovementY||0,i=this.camera;lt.setFromQuaternion(i.quaternion),lt.y-=t*.002*this.pointerSpeed,lt.x-=e*.002*this.pointerSpeed,lt.x=Math.max(le-this.maxPolarAngle,Math.min(le-this.minPolarAngle,lt.x)),i.quaternion.setFromEuler(lt),this.dispatchEvent(ti)}function oi(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(ei),this.isLocked=!0):(this.dispatchEvent(ii),this.isLocked=!1)}function ri(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}function ai(d,t){const e=new ni(d,document.body);let i=!1;const n=.15,s={w:!1,a:!1,s:!1,d:!1},r=new g.Vector3;return document.addEventListener("click",()=>{i&&e.lock()}),e.addEventListener("lock",()=>{t.style.display="none"}),e.addEventListener("unlock",()=>{i&&(t.style.display="block")}),document.addEventListener("gameStart",()=>{i=!0,t.style.display="block",console.log("Controls enabled - Game has started!")}),document.addEventListener("keydown",o=>{if(i)switch(o.code){case"KeyW":s.w=!0;break;case"KeyA":s.a=!0;break;case"KeyS":s.s=!0;break;case"KeyD":s.d=!0;break}}),document.addEventListener("keyup",o=>{if(i)switch(o.code){case"KeyW":s.w=!1;break;case"KeyA":s.a=!1;break;case"KeyS":s.s=!1;break;case"KeyD":s.d=!1;break}}),{controls:e,moveSpeed:n,keys:s,velocity:r}}function hi(d){d.fog=new g.FogExp2(9145198,.065),d.background=new g.Color(9145198);const t=new g.AmbientLight(8023901,5);d.add(t);const e=new g.DirectionalLight(16752762,1);e.position.set(-1,.2,-.2),d.add(e);const i=new g.PlaneGeometry(150,150),n=new g.MeshLambertMaterial({color:6052941,side:g.DoubleSide}),s=new g.Mesh(i,n);return s.rotation.x=-Math.PI/2,d.add(s),{ground:s,ambientLight:t,directionalLight:e,groundMaterial:n}}function li(d,t){d.fog.color.setHex(4868698),d.background.setHex(4868698),t.ambientLight.color.setHex(4868698),t.ambientLight.intensity=10,t.directionalLight.color.setHex(6974074),t.directionalLight.intensity=2,t.groundMaterial.color.setHex(2763322)}const ci="modulepreload",di=function(d){return"/"+d},ce={},ui=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(e.map(a=>{if(a=di(a),a in ce)return;ce[a]=!0;const h=a.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${l}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":ci,h||(c.as="script"),c.crossOrigin="",c.href=a,o&&c.setAttribute("nonce",o),document.head.appendChild(c),h)return new Promise((m,u)=>{c.addEventListener("load",m),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return n.then(r=>{for(const o of r||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};class mi{constructor(){this.sounds={},this.activeSounds=[],this.reducedVolumeSounds=["collect","tick","trade"],this.isGameOver=!1,document.addEventListener("gameOver",()=>{this.stopAllSounds(),this.isGameOver=!0})}loadSound(t,e){const i=new Audio(e);return this.sounds[t]=e,i}playSound(t,e={}){if(this.isGameOver)return null;const i=this.sounds[t]||t,n=new Audio(i),s=e.volume!==void 0?e.volume:1,r=e.randomPitch||!1;let o=s;const a=Object.keys(this.sounds).find(h=>this.sounds[h]===i)||t;return this.reducedVolumeSounds.includes(a)&&(o=s*.5),n.volume=o,r&&(n.playbackRate=.9+Math.random()*.2),n.play().catch(h=>{console.error(`Error playing sound: ${t}`,h);const l=this.activeSounds.indexOf(n);l!==-1&&this.activeSounds.splice(l,1)}),this.activeSounds.push(n),n.addEventListener("ended",()=>{const h=this.activeSounds.indexOf(n);h!==-1&&this.activeSounds.splice(h,1)}),n}stopAllSounds(){console.log(`Stopping all ${this.activeSounds.length} active sounds`);const t=[...this.activeSounds];for(const e of t)e.pause(),e.currentTime=0;this.activeSounds=[]}stopSoundsBySource(t){const e=this.activeSounds.filter(i=>i.src.includes(t));if(e.length>0){console.log(`Stopping ${e.length} sounds matching: ${t}`);for(const i of e){i.pause(),i.currentTime=0;const n=this.activeSounds.indexOf(i);n!==-1&&this.activeSounds.splice(n,1)}}}play(t,e={}){return this.sounds[t]?(e.randomPitch===void 0&&(e.randomPitch=["tick","collect","trade"].includes(t)),this.playSound(t,e)):(console.error(`Sound "${t}" not found. Make sure to load it first.`),null)}}const U=new mi;function pi(d){const t=new g.AudioListener;d.add(t);const e=new g.Audio(t),i=new g.AudioLoader;return U.loadSound("tick","assets/sounds/tick.mp3"),U.loadSound("collect","assets/sounds/collect.mp3"),U.loadSound("trade","assets/sounds/trade.mp3"),U.loadSound("scare","assets/sounds/scare.mp3"),U.loadSound("shepardsFear","assets/sounds/shepards fear.mp3"),console.log("Audio system initialized"),{listener:t,ambientSound:e,audioLoader:i}}class yi{constructor(){this.uiContainer=document.createElement("div"),this.uiContainer.id="game-ui-container",this.uiContainer.style.position="fixed",this.uiContainer.style.top="0",this.uiContainer.style.left="0",this.uiContainer.style.width="100%",this.uiContainer.style.height="100%",this.uiContainer.style.pointerEvents="none",this.uiContainer.style.zIndex="100",document.body.appendChild(this.uiContainer),this.terminalElement=null,this.terminalTimeout=null,this.countdownInterval=null,this.countdownElement=null,this.labelTypingSpeed=1,this.contentTypingSpeed=5,this.lastTickTime=0,this.merchantUI=null,this.initializeMerchantUI();const t=document.createElement("style");t.textContent=`
            .typing-text {
                display: inline-block;
            }
            .typing-cursor {
                display: inline-block;
                width: 0.6em;
                height: 1.2em;
                background-color: rgba(255, 255, 255, 0.8);
                vertical-align: middle;
                margin-left: 2px;
                animation: blink 0.7s infinite;
            }
            @keyframes blink {
                0%, 100% { opacity: 1; }
                50% { opacity: 0; }
            }
        `,document.head.appendChild(t),document.addEventListener("showText",e=>{const{message:i,duration:n,position:s,className:r}=e.detail;this.showText(i,n,s,r)}),console.log("UIManager initialized.")}async _loadHTML(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const i=await e.text(),n=document.createElement("template");n.innerHTML=i.trim();const s=n.content.querySelector("body");return s?s.innerHTML:n.innerHTML}catch(e){return console.error(`Error loading HTML from ${t}:`,e),null}}_injectUI(t,e,i){const n=document.createElement("div");return n.id=e,n.classList.add(i),n.innerHTML=t,this.uiContainer.appendChild(n),n}async showTerminal(t,e=5e3){console.log(`Showing terminal message: "${t}"`),this.terminalTimeout&&(clearTimeout(this.terminalTimeout),this.terminalElement&&this.terminalElement.remove(),this.terminalElement=null);const i=await this._loadHTML("terminal.html");if(!i)return;this.terminalElement=this._injectUI(i,"terminal-ui-instance","terminal-ui");const n=this.terminalElement.querySelector("#terminal-message");n?n.textContent=t:(this.terminalElement.textContent=t,console.warn("Terminal HTML structure might be missing #terminal-message.")),requestAnimationFrame(()=>{setTimeout(()=>{this.terminalElement&&this.terminalElement.classList.add("active")},10)}),this.terminalTimeout=setTimeout(()=>{this.terminalElement&&(this.terminalElement.classList.remove("active"),setTimeout(()=>{this.terminalElement&&(this.terminalElement.remove(),this.terminalElement=null,this.terminalTimeout=null)},500))},e)}async showCountdown(t,e){console.log(`Starting countdown: ${t} seconds.`),this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownElement&&this.countdownElement.remove(),this.countdownElement=null,this.countdownInterval=null);const i=await this._loadHTML("countdown.html");if(!i)return;this.countdownElement=this._injectUI(i,"countdown-ui-instance","countdown-ui");const n=this.countdownElement.querySelector("#countdown-timer");if(!n){console.error("Countdown HTML is missing #countdown-timer."),this.countdownElement&&this.countdownElement.remove(),this.countdownElement=null;return}let s=t,r=!1,o=null,a=!0;const h=()=>{const l=Math.floor(s/60),c=s%60;n.textContent=`${l}:${c.toString().padStart(2,"0")}`,s>0&&Date.now()-this.lastTickTime>=950,s<=0&&!r&&(r=!0,e&&typeof e=="function"&&e(),clearInterval(this.countdownInterval),this.countdownInterval=null,o=setInterval(()=>{a=!a,this.countdownElement&&(this.countdownElement.style.visibility=a?"visible":"hidden")},500),setTimeout(()=>{console.log("13 seconds after countdown reached zero - Auto spawning monster"),document.dispatchEvent(new CustomEvent("spawnMonster")),o&&(clearInterval(o),o=null),this.countdownElement&&(this.countdownElement.classList.remove("active"),setTimeout(()=>{this.countdownElement&&(this.countdownElement.remove(),this.countdownElement=null)},300))},13e3)),r||s--};h(),requestAnimationFrame(()=>{setTimeout(()=>{this.countdownElement&&this.countdownElement.classList.add("active")},10)}),this.countdownInterval=setInterval(h,1e3)}async showText(t,e=3e3,i="top-center",n=null){console.log(`Showing text: "${t}" for ${e}ms`);const s=await this._loadHTML("text.html");if(!s)return;const r=`text-ui-${Date.now()}`,o=this._injectUI(s,r,"text-ui");o.classList.add(i),n&&o.classList.add(n);const a=o.querySelector("#text-message");a?a.textContent=t:(o.textContent=t,console.warn("Text HTML structure might be missing #text-message.")),requestAnimationFrame(()=>{setTimeout(()=>{o.classList.add("active")},10)}),setTimeout(()=>{o.classList.remove("active"),setTimeout(()=>{o.remove()},400)},e)}async initializeMerchantUI(){if(!this.merchantUI){const t=(await ui(async()=>{const{default:e}=await import("./merchant-XSnCxQK-.js");return{default:e}},[])).default;this.merchantUI=new t(this)}}updateMerchantUI(t){this.merchantUI&&this.merchantUI.update(t)}hideMerchantUI(){this.merchantUI&&this.merchantUI.hide()}async typewriterEffect(t,e){return new Promise(i=>{if(!e){i();return}t.textContent="";const n=document.createElement("span");n.className="typing-text";const s=document.createElement("span");s.className="typing-cursor",t.appendChild(n),t.appendChild(s);let r="",o=0;const a=t.classList.contains("merchant-label")?this.labelTypingSpeed:this.contentTypingSpeed,h=()=>{if(o<e.length){const l=e[o];r+=l,n.textContent=r,o++;const c=a*.2,m=a+(Math.random()*c*2-c);requestAnimationFrame(()=>setTimeout(h,m))}else s.remove(),i()};h()})}}const ot=new yi;function gi(d="Click to Start"){const t=ot.uiContainer,e=document.createElement("div");e.id="instructions",e.textContent=d,Object.assign(e.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",fontSize:"36px",fontFamily:"monospace",textAlign:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"10px",cursor:"pointer",pointerEvents:"auto",zIndex:"101"}),t.appendChild(e);const i=document.createElement("div");i.id="disc-counter",Object.assign(i.style,{position:"absolute",top:"10px",left:"10px",color:"white",fontFamily:"monospace",fontSize:"24px",zIndex:"101",pointerEvents:"none",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"}),i.textContent="Discs: 0",t.appendChild(i);const n=document.createElement("div");return n.id="money-counter",Object.assign(n.style,{position:"absolute",top:"40px",left:"10px",color:"white",fontFamily:"monospace",fontSize:"24px",zIndex:"101",pointerEvents:"none",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"}),n.textContent="Assets: $0",t.appendChild(n),console.log("Initial game UI (instructions, counters) set up."),{uiContainer:t,instructions:e,discCounterElement:i,moneyCounterElement:n}}const de={Chill:{genres:["Lo-fi","Chillout","Ambient","Folk","Acoustic","Bossa Nova","Bedroom Pop","City Pop","Jazz","Classical","Synthwave","Vaporwave","Techno","Trance","Dubstep","Drum & Bass","Blues","Funk","Disco","Latin","IDM","Darkwave","8bit"],adjectives:["Smooth","Smoky","Hazy","Faded","Satin","Silk","Blue","Yellow","Purple","Twilight","Slow","Glass","Velvet","Plush","Sleek","Icy","Dusty","Blurry","Solar","Golden","Pale","Soft","Bitter","Lunar","Warm","Fragile","Tidal","Worn","Bare","Strange","Dim","Handwritten","Silver","Topaz","Hidden","Cursive","Wooden","First","Second"],nouns:["Waves","Lights","Evening","Tape","Signal","Clouds","Dreams","Lavender","Sidewalk","Kids","Postcard","Satellites","Ashes","Skylight","Bruises","Matches","Blush","Film","Hometown","Daydream","Polaroid","Smokehalos","Ghost","Train","Marble","Locket","Ceiling","Fireflies","Passenger","Snowglobe","Beach","Ink","Porchlight","Gravel","Fingertips","Moonlight","Lantern","Sleep","Match","Scarf","Silence","Butterfly","Window","Ember","Breeze","Paper","Letter","Closet","Blanket","Bloom","Haze","Key","Spark","Branch","Record","Flicker","Driftwood","September","October","Orbit","Crayon","Pine","Tea","Sparrow","Hummingbird","Venus","Meteor"],title_formats:["[Adjective] [Noun]","[Noun]","[Adjective]","[Adjective] [Noun]","[Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]"],artist_formats:["[Noun]","[Adjective] [Noun]","The [Adjective]","The [Adjective] [Noun]","[Adjective]"]},Sad:{genres:["Midwest Emo","Emo","Slowcore","Blues","Soul","R&B","Gospel","Post-Hardcore","Screamo","Experimental"],adjectives:["Lonely","Hollow","Blue","Desolate","Isolated","Lost","Forsaken","Hopeless","Broken","Bleak","Empty","Cold","Dark","Gray","Quiet","Somber","Haunting","Distant","Dim","Faded","Dying","Late","Old","Crying","Last","Crushed","Torn","Heavy","Foggy","Vacant","Lifeless","Misfit","Invisible","Waning","Buried","Left","First","Second","Small","Hidden","Remote","Modern","Ancient","Flat"],nouns:["Ache","Sorrow","Chair","Couch","Ocean","Regret","Guilt","Dread","Shame","Fog","Cold","Rain","Shadow","Gloom","Haze","Snowfall","Dusk","Goodbye","Memory","Past","Distance","Absence","Yearning","Nostalgia","Loss","Delay","Remains","Separation","Isolation","Window","Scar","Candle","Bed","Mirror","Photograph","Letter","Frame","Ring","Grave","Clock","Train","Suitcase","Locket","Ribbon","Chain","Coin","Key","Mask","Envelope","Compass","Anchor","Flame","Lantern","Blade","Knife","Umbrella","Shell","Stone","Bone","Cat","Painting","Crutch","Sword","Chainmail","Net","Cage","Bridge","Shard","Sun","Moon","Ash","Planet","Ember","Dust","Ink","Record","Gear","Box","Safe","Pluto","Asteroid"],title_formats:["[Adjective] [Noun]","[Noun] of [Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]","[Noun]"],artist_formats:["The [Adjective] [Noun]","The [Adjective] [Noun]","[Noun]","[Adjective]"]},Happy:{genres:["Pop","Disco","Funk","Latin","Bossa Nova","Reggae","Ska","Surf Rock","Alternative","Alt Rock"],adjectives:["Beloved","Bold","Brave","Golden","Holy","Peaceful","Wild","Radiant","Timeless","Silent","Burning","Innocent","Gentle","Fragile","Sacred","Shiny","Warm","Bright","Dreamy","Electric","Surreal","Neon","Cosmic","Lucid","Vivid","Luminous","Hypnotic","Atomic","Vibrant","Sonic","Charged","Icy","Infinite","Chrome","Silver","Sublime","Wavy","Strange","Polar","Slick","Crystalline","Blinding","Amplified","Digital","Searing","Laced","Deep","Midnight","Glacial","Wired","First","Second","Last","Hot"],nouns:["Heart","Love","Days","Sun","Candy","Petal","Apple","Honey","Glow","Shell","Kids","Charm","Lake","Pond","Ocean","Gem","Ruby","Sapphire","Friend","Comet","Cloud","Baby","Locket","Train","Drive","Horizon","Beach","Eyes","Drift","Stone","Fold","Earth","Jupiter"],title_formats:["[Adjective] [Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]","[Noun]"],artist_formats:["The [Adjective] [Noun]","[Adjective]","[Noun]","[Adjective] [Noun]","[Noun] of [Adjective]"]},Edgy:{genres:["Punk","Metal","Noise","Shoegaze","Industrial","Hardcore","Breakcore","Nu-Metal","Math Rock","Black Metal","Grunge","Grungegaze","Post-Punk","Rock"],adjectives:["Blunt","Brutal","Dark","Feral","Flaming","Cold","Hostile","Jaded","Rogue","Toxic","Hollow","Cursed","Bleeding","First","Second","Last","Small","Hidden","Remote","Modern","Ancient","Flat"],nouns:["Leather","Switchblade","Cigarette","Chain","Boots","Skull","Ring","Bike","Mirror","Gas","Mask","Smoke","Blade","Saw","Tag","Denim","Flare","Book","Wire","Ashtray","Claw","Hammer","Bottle","Watch","Bag","Flag","String","Fish","Code","Program","Safe","Shortcut","Scar","Eye","Spider","Star","Chrome","Satellite","Trap","Tooth","Dream","Car","Today","Day","Memory","Space","Shadow","Ceiling","Root","Food","Plastic","Fighter","Disease","Plague","Doctor","Angel","Multiply","Moon","Blur","Moment","Show","Pig","Animal","Cow","Bull","Danger","Neptune","Mercury"],title_formats:["[Adjective] [Noun]","[Noun] of the [Noun]","[Noun]","[Adjective]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]"],artist_formats:["[Noun]","The [Adjective]","[Adjective] [Noun]","[Noun]","The [Adjective] [Noun]","[Adjective] Head","[Adjective]","[Noun] of [Noun]","[Noun] of [Adjective]"]},Angry:{genres:["Hardcore","Trap","Boom Bap","Metal","Grungegaze","Hip-Hop","Crunk","Cloud Rap","Emo Rap","Hyperpop","Mixtape"],adjectives:["Raging","Violent","Explosive","Savage","Vicious","Blazing","First","Second","Last","Thick","Dry","Dirty","Red","Scarlet","Bloody","Large","Heavy","Local","Rare","Common","Normal","Derranged"],nouns:["Fury","War","Punch","Fire","Blade","Enemy","Disease","Dirt","Glass","Knife","Stab","Eclipse","Dog","Wolf","Dragon","Sun","Gas","Belt","Brick","Tile","Pile","Nose","Fan","Clown","Brain","Needle","Scar","Wound","Control","Virus","Chain"],title_formats:["[Adjective] [Noun]","[Noun]","No [Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]"],artist_formats:["[Noun]","[Adjective]","[Noun] of [Noun]","[Noun] of [Adjective]","[Adjective] [Noun]"]}},fi=["Mint","Good","Worn","Damaged","Broken"],xi=["Common","Uncommon","Rare","Cult Classic","Illegal"],wi={Mint:5,Good:25,Worn:40,Damaged:20,Broken:10},Mi={Common:50,Uncommon:25,Rare:15,"Cult Classic":7,Illegal:3},bi={Mint:1,Good:.8,Worn:.6,Damaged:.4,Broken:.2},_i={Common:1,Uncommon:2,Rare:4,"Cult Classic":8,Illegal:16};function Ci(d,t){const i=(Math.floor(Math.random()*91)+10)*bi[d]*_i[t],n=.8+Math.random()*.4;return Math.floor(i*n)}function V(d){return d[Math.floor(Math.random()*d.length)]}function ue(d,t){let e=d;return e=e.replace(/\[Adjective\]/g,()=>V(t.adjectives)),e=e.replace(/\[Noun\]/g,()=>V(t.nouns)),e=e.replace(/\[Nouns\]/g,()=>V(t.nouns)+"s"),e}function me(d,t){const e=Object.values(t).reduce((n,s)=>n+s,0);let i=Math.random()*e;for(let n=0;n<d.length;n++)if(i-=t[d[n]],i<=0)return d[n];return d[0]}function Si(d,t,e,i,n,s){const r={Mint:{Common:["Still sealed. Huh. Probably worth more than me.","Looks fresh out the bin. Some poor soul never got to play it.","Not a scratch. Either you got lucky or you're better at digging than most.","Factory-new? In this dustpile? I'm shocked."],Uncommon:["Mint condition. Makes my circuits purr.","Pristine like a priest's lie. Rare find, this.","Like it was born yesterday. I almost feel bad taking it from you.","No dust, no scars... no soul. But pretty, I'll give it that."],Rare:["Mint. You know what you've got, right?","Perfect shape. Almost makes me forget we're buried in ash.","Not a nick. This one lived a better life than I did.","Pristine. Like someone preserved it for the second coming."],"Cult Classic":["Mint. If I had a heart, it'd skip a beat.","Flawless. This was someone's religion once.","So clean it hurts. Hurts like memory.","Like it was waiting for the right hands. Yours, apparently."],Illegal:["Mint and forbidden. Dangerous combo.","Pristine sin. Hope you've got somewhere to hide it.","Flawless and flagged. Even I wouldn't risk playing this one.","You know what this is. And now I know you know."]},Good:{Common:["Good shape. Plays fine, if you ignore the ghosts.","Minor scuffs. Adds character.","Solid condition. Could survive another apocalypse.","Not bad. Probably passed through a dozen hands and kept its dignity."],Uncommon:["Decent find. Might even be authentic.","Little worn, still proud. Like an old soldier.","Better than most of what people bring me.","You've got a nose for quality, I'll give you that."],Rare:["Still breathin'. That's more than I can say for most things.","A little scratched, a lot precious.","Rarity like this doesn't care about blemishes.","This one's seen things. It remembers."],"Cult Classic":["Magic's still in there. You can smell it.","A bit worn, but it hums. Listen close.","This disc meant something. Still does.","You don't find these—you're called to them."],Illegal:["Good shape. Bad karma.","You touch this, you risk waking up somewhere you don't recognize.","The less we say about this, the better. Nod if you understand.","Still dangerous. Maybe more so now that it's wounded."]},Worn:{Common:["Worn down like the rest of us.","Seen better days. Haven't we all?","Still standing. That's what counts.","Rough around the edges. Like most survivors."],Uncommon:["Not much to look at, but there's a heartbeat in there.","Weathered. That's history in your hands.","Keeps spinning. That's more than I expected.","Scarred, but not silent."],Rare:["This one crawled through the mud to find you.","Hurt, but honest. I respect that.","Bruised treasure. Let's not waste it.","Fell far to get here. Don't drop it again."],"Cult Classic":["It's bled for meaning. Still bleeding.","Ragged edge. Holy core.","Legend never needed polish.","It's ugly. And it's perfect."],Illegal:["Worn outlaw tech. They'd gut you for this.","If you value silence, don't let anyone else see it.","Torn from the void. Left a scar.","Dangerous even in pieces. Treat with respect—or fear."]},Damaged:{Common:["Cracked, but talkative.","Might squeal when played. Don't blame me.","Falling apart, but desperate to be remembered.","Not pretty, but it wants to be seen."],Uncommon:["Bit rough. Still sings.","Looks worse than it sounds. Maybe.","Not worthless, just misunderstood.","Hurt, but holding."],Rare:["Barely breathing. Still sacred.","Scraped up survivor. You're in good company.","Damage makes it real."],"Cult Classic":["Wounded worship. Handle with reverence.","Still holy. Even bruised.","Scars like these tell tales.","It's lived. That's what makes it matter."],Illegal:["Bad news in a cracked shell.","One glance and the wrong eyes would hunt you.","Still pulsing with secrets.","Don't keep it near your heart."]},Broken:{Common:["Dead tech. Nice paperweight, though.","Doesn't play. Still makes noise if you listen hard enough.","Totally busted. But someone once cared about it.","Worthless... or is it? Nah. Probably worthless."],Uncommon:["Broken, but full of ghosts.","You could try to fix it. Or mourn it.","Ruined, but not forgotten.","It cracked open. Something escaped."],Rare:["Even shattered, this one demands attention.","Broken relic. Dangerous beauty.","Dust and splinters. And memory.","Destroyed. But you can still feel the heat."],"Cult Classic":["Legends don't die. They fracture.","Shattered, but it hums in another frequency.","If you dream hard enough, you'll hear it again.","Broken altar to a forgotten god."],Illegal:["Even dead, it's outlawed.","You're braver than you look, holding this.","This shouldn't exist. And yet...","Throw it in the fire. Or keep it. Your call."]}},o={Illegal:{Broken:["Dead as a ghost, but still illegal. The signal never really dies.","Doesn't function. Still dangerous. That's power.","Shattered, but the kind that echoes in forbidden channels.","Non-functional? Tell that to the black vans parked outside."],Damaged:["It limps. It leaks. It shouldn't be here.","Still pings hidden frequencies. I heard them last night.","Wounded and wrong. But priceless in the underworld.","You didn't find this. It found you."]},"Cult Classic":{Broken:["Broken, but this was gospel once.","Doesn't spin, but it still chants.","It's more shrine than disc now.","A relic shattered, not erased."],Damaged:["Scuffed, but every mark tells a myth.","Worn edges, timeless core.","Flickering magic. Still alive in there.","This one's legacy outweighs its wounds."]}};return o[t]&&o[t][d]?V(o[t][d]):V(r[d][t])}function ki(){const d=V(Object.keys(de)),t=de[d],e=V(t.genres),i=ue(V(t.artist_formats),t),n=ue(V(t.title_formats),t),s=me(fi,wi),r=me(xi,Mi),o=Ci(s,r);return{title:n,artist:i,genre:e,value:`$${o}`,condition:s,rarity:r,quote:Si(s,r)}}class zi{constructor(){this.currentDiscData=null,this._canTrade=!1,this.soldDiscsCount=0}getDiscCount(){return k.discCount}enableTrading(){this._canTrade=!0}disableTrading(){this._canTrade=!1}canTradeDiscs(){return this._canTrade&&k.discCount>0}updateDiscCounter(){const t=document.getElementById("disc-counter");t&&(t.textContent=`Discs: ${k.discCount}`)}generateNewDisc(){return console.log("Attempting to generate new disc. Current count:",k.discCount),k.discCount>0?(this.currentDiscData=ki(),console.log("Generated new disc data:",this.currentDiscData),this.currentDiscData):(console.log("No discs available for generation"),null)}tradeDisc(){if(console.log("Attempting to trade disc. Can trade:",this._canTrade,"Count:",k.discCount),this._canTrade&&k.discCount>0){k.discCount--,this.updateDiscCounter();const t=this.generateNewDisc();return U.play("trade",{randomPitch:!0}),this.soldDiscsCount++,this.soldDiscsCount===15&&(console.log("15th disc sold - Initiating final sequence"),document.dispatchEvent(new CustomEvent("finalSequenceStart"))),console.log("Traded disc. New count:",k.discCount,"Total sold:",this.soldDiscsCount),t}return console.log("Trade failed: trading disabled or no discs available"),null}}const mt=new zi;class Ei{constructor(){this._discCount=0,this._money=0,this.position={x:0,y:0,z:0},this.forward={x:0,y:0,z:-1},this.monster=null,this.updateMoneyDisplay(),this.boundary={minX:-50,maxX:50,minZ:-50,maxZ:50}}get discCount(){return this._discCount}set discCount(t){this._discCount=t;const e=document.getElementById("disc-counter");e&&(e.textContent=`Discs: ${this._discCount}`)}get money(){return this._money}set money(t){this._money=t,this.updateMoneyDisplay()}addMoney(t){const e=typeof t=="string"?parseInt(t.replace(/\$/,"")):t;isNaN(e)?console.error("Invalid money value:",t):(this._money+=e,console.log("Added money:",e,"New total:",this._money),this.updateMoneyDisplay())}collectDisc(){this.discCount++,console.log("Player collected disc. New count:",this.discCount)}setBoundary(t,e=0){this.boundary={minX:-50+e,maxX:100/2-e,minZ:-50+e,maxZ:100/2-e},this.originalBoundary={xRange:"±50",zRange:"±50",actualMinX:-50+e,actualMaxX:50-e,actualMinZ:-50+e,actualMaxZ:50-e},console.log("Player boundaries set:",this.boundary)}clampPositionToBoundary(t,e){const i=Math.max(this.boundary.minX,Math.min(this.boundary.maxX,t)),n=Math.max(this.boundary.minZ,Math.min(this.boundary.maxZ,e));return{x:i,z:n}}updatePosition(t,e,i){const n=this.clampPositionToBoundary(t,i);this.position.x=n.x,this.position.y=e,this.position.z=n.z,this.monster&&this.monster.isActive&&(this.monster.update(this.position,this.forward),this.checkMonsterVisibility())}updateForwardDirection(t,e,i){this.forward={x:t,y:e,z:i}}setMonsterReference(t){this.monster=t}spawnMonster(){this.monster&&!this.monster.isActive&&this.monster.spawn(this.position,this.forward)}checkMonsterVisibility(){!this.monster||!this.monster.isActive||this.monster.isPlayerLooking(this.position,this.forward)&&this.monster.triggerJumpscare()}updateMoneyDisplay(){const t=document.getElementById("money-counter");t&&(t.textContent=`Assets: $${this._money}`)}}const k=new Ei;class vi{constructor(){this.isActive=!1,this.monsterSpawned=!1,document.addEventListener("spawnMonster",()=>{this.monsterSpawned=!0})}startFinalSequence(){this.isActive||(this.isActive=!0,this.monsterSpawned=!1,ot.showCountdown(120,()=>{console.log("Countdown finished - Zero reached")}),setTimeout(()=>{console.log("Playing Shepard's Fear"),U.play("shepardsFear",{volume:.9})},3e4))}}const Ai=new vi,Ti=1,Gt=2;let A=null,gt=null,Wt=null;function Di(){return new Promise((d,t)=>{Wt||(Wt=new Lt),Wt.load("assets/models/CD.glb",e=>{gt=e.scene.clone(),gt.traverse(i=>{if(i.isMesh){const n=i.material,s=new g.MeshStandardMaterial({map:n.map,emissive:16711680,emissiveIntensity:5,metalness:0,roughness:1});i.material=s}}),console.log("✅ Lost Disc model loaded successfully with red glow effect!"),d(gt)},e=>{if(e.lengthComputable){const i=e.loaded/e.total*100;console.log(`📊 Lost Disc model loading progress: ${i.toFixed(2)}%`)}},e=>{console.error("❌ Error loading Lost Disc model:",e),t(e)})})}async function Li(d){new Audio("assets/sounds/shepards fear.mp3");try{await Di()}catch(t){console.error("Failed to load lost disc model:",t)}return document.addEventListener("finalSequenceStart",()=>{console.log("Final sequence started - spawning Lost Disc"),Fi(d)}),{checkLostDiscCollection:Pi,animateLostDisc:be,setNormalDiscs:Ii}}function Ii(d){}function Fi(d){if(A)return;const t=g.MathUtils.randFloat(-50,50),e=g.MathUtils.randFloat(-50,50);gt?(A=gt.clone(),A.position.set(t,Gt,e),A.rotation.x=Math.PI/2,d.add(A),console.log("Lost Disc spawned at:",t,Gt,e),ot.showText("THE LOST DISC HAS APPEARED",3e3,"top-center","lost-disc"),document.dispatchEvent(new CustomEvent("lostDiscEnvironmentChange"))):console.error("Failed to spawn Lost Disc: model not loaded")}function Pi(d){if(!A)return;Math.sqrt(Math.pow(d.x-A.position.x,2)+Math.pow(d.z-A.position.z,2))<Ti&&(A.parent.remove(A),A=null,console.log("Lost Disc collected - Starting final countdown"),Ai.startFinalSequence())}function be(d){A&&(A.rotation.z=d*4,A.position.y=Gt+Math.sin(d*2)*.1,A.traverse(t=>{if(t.isMesh&&t.material&&t.material.emissiveIntensity!==void 0){const e=4+(Math.sin(d*3)*1.5+1.5);t.material.emissiveIntensity=e,t.material.needsUpdate=!0}}))}const Ri=20,Bi=1,pe=5,Et={minX:-50,maxX:50,minZ:-50,maxZ:50},Oi=new g.Vector3(0,0,0),Ni=5,ye=10;let ft=null;const T=[];let pt=null,jt=null;function Ui(){return new Promise((d,t)=>{jt||(jt=new Lt),jt.load("assets/models/CD.glb",e=>{pt=e.scene.clone(),pt.scale.set(1,1,1),pt.traverse(i=>{if(i.isMesh){const n=i.material,s=new g.MeshStandardMaterial({map:n.map,emissive:14913298,emissiveIntensity:5,metalness:0,roughness:1});i.material=s}}),console.log("✅ CD model loaded successfully with glow effect!"),d(pt)},e=>{if(e.lengthComputable){const i=e.loaded/e.total*100;console.log(`📊 CD model loading progress: ${i.toFixed(2)}%`)}},e=>{console.error("❌ Error loading CD model:",e),t(e)})})}function _e(){let t=0;for(;t<50;){const e=g.MathUtils.randFloat(Et.minX,Et.maxX),i=g.MathUtils.randFloat(Et.minZ,Et.maxZ),n=.5,s=new g.Vector3(e,n,i);if(s.distanceTo(Oi)<pe){t++;continue}let r=!1;for(const o of T)if(s.distanceTo(o.position)<pe){r=!0;break}if(!r)return console.log(`Found valid disc position at (${e.toFixed(2)}, ${n}, ${i.toFixed(2)})`),s;t++}return console.log("Failed to find valid position after 50 attempts"),null}function Ce(d,t){const e=pt.clone();e.position.copy(t),e.rotation.x=Math.PI/2,d.add(e),T.push(e),console.log(`Spawned disc at (${t.x.toFixed(2)}, ${t.y}, ${t.z.toFixed(2)})`)}function Hi(d){if(T.length<=Ni){console.log(`Disc count (${T.length}) below threshold, spawning ${ye} new discs`);let t=0;for(let e=0;e<ye;e++){const i=_e();i&&(Ce(d,i),t++)}t>0?console.log(`Successfully spawned ${t} new discs. Total discs now: ${T.length}`):console.log("Failed to spawn any new discs - no valid positions found")}}function Tt(){ft&&(ft.textContent=`Discs: ${k.discCount}`)}async function Wi(d){k.discCount=0,ft=document.getElementById("disc-counter"),ft?Tt():console.error("Disc counter element (#disc-counter) not found in the DOM. Make sure setupGameUI runs first.");try{await Ui()}catch(t){return console.error("Failed to load disc model:",t),{discs:[],checkDiscCollection:()=>{},updateDiscCounter:Tt}}for(let t=0;t<Ri;t++){const e=_e();e&&Ce(d,e)}return console.log(`Created ${T.length} collectible discs`),{discs:T,checkDiscCollection:ji,updateDiscCounter:Tt}}function ji(d){if(!ft||T.length===0)return;let t=!1,e=null;for(let i=T.length-1;i>=0;i--){const n=T[i];if(!n||!n.parent){T.splice(i,1);continue}!e&&n.parent&&(e=n.parent),Math.sqrt(Math.pow(d.x-n.position.x,2)+Math.pow(d.z-n.position.z,2))<Bi&&(n.parent.remove(n),T.splice(i,1),k.collectDisc(),t=!0,U.play("collect",{randomPitch:!0}),ot.showText("Disc Acquired!",2e3,"top-center"))}t&&(Tt(),console.log(`Current disc count: ${T.length}`),e&&Hi(e))}function Gi(d){for(const t of T)if(t.rotation.z=d*3,t.traverse(e=>{if(e.isMesh&&e.material&&e.material.emissiveIntensity!==void 0){const i=.3+(Math.sin(d*2)*.25+.25);e.material.emissiveIntensity=i,e.material.needsUpdate=!0}}),t.userData.light){const e=.5+(Math.sin(d*2)*.25+.25);t.userData.light.intensity=e}}function qi(d,t=null){for(let n=0;n<3;n++){let r=function(o,a){const h=new g.Group,l=4868668,c=6+Math.floor(Math.random()*4);for(let m=0;m<c;m++){const u=.7+Math.random()*.8,p=new g.BoxGeometry(.08,u,.08),y=new g.Color(l).offsetHSL(0,0,(Math.random()-.5)*.1),x=new g.MeshLambertMaterial({color:y}),f=new g.Mesh(p,x),C=m/c*Math.PI*2+(Math.random()-.5)*.5,S=.3+Math.random()*Math.PI*.25;f.position.y=0,f.rotation.order="YXZ",f.rotation.y=C,f.rotation.x=S;const b=.1;f.position.x=Math.cos(C)*b*Math.random(),f.position.z=Math.sin(C)*b*Math.random(),h.add(f)}h.position.set(o,0,a),d.add(h)};const s=new g.Vector3((Math.random()-.5)*100*2,0,(Math.random()-.5)*100*2);if(!(t&&!t(s)))for(let o=0;o<50;o++){const a=(Math.random()-.5)*80,h=(Math.random()-.5)*80;r(a,h)}}}const G=new g.MeshLambertMaterial({color:11184810});function Vi(d,t,e){const i=new g.Vector3(0,d.y,0);if(d.distanceTo(i)<e)return!0;for(const n of t)if(Math.sqrt(Math.pow(d.x-n.x,2)+Math.pow(d.z-n.z,2))<e)return!0;return!1}function Yi(){const d=g.MathUtils.randFloat(1,1.4),t=g.MathUtils.randFloat(.6,.8),e=t*.5,i=g.MathUtils.randFloat(.9,1.3),n=t*.2,s=n,r=d*.8,o=t*.15,a=o,h=g.MathUtils.randFloat(.4,.5),l=.15,c=h*.6,m=t*.2,u=m,p=u,y=new g.BoxGeometry(t,d,e),x=new g.BoxGeometry(h,h,h),f=new g.BoxGeometry(c,l,c),C=new g.BoxGeometry(n,i,s),S=new g.BoxGeometry(o,r,a);S.translate(0,r/2,0);const b=new g.BoxGeometry(m,u,p),M=new g.Mesh(y,G),_=new g.Mesh(x,G),w=new g.Mesh(f,G),H=new g.Mesh(C,G),W=new g.Mesh(C,G),P=new g.Mesh(S,G),v=new g.Mesh(S,G),N=new g.Mesh(b,G),$=new g.Mesh(b,G);w.position.y=d/2+l/2,_.position.y=w.position.y+l/2+h/2;const K=t/2+m/2,tt=d/2-u/2;N.position.set(-K,tt,0),$.position.set(K,tt,0);const et=-u/2;N.add(P),$.add(v),P.position.set(0,et,0),P.rotation.x=g.MathUtils.degToRad(10),v.position.set(0,et,0),v.rotation.x=g.MathUtils.degToRad(10);const it=t/2-n/2-.05,nt=-(d/2+i/2);H.position.set(-it,nt,0),W.position.set(it,nt,0);const I=new g.Group;return I.add(M),I.add(_),I.add(w),I.add(N),I.add($),I.add(H),I.add(W),{mesh:I,heightInfo:{torsoHeight:d,legHeight:i}}}function Xi(d,t,e,i,n,s=null){const r=[];let o=0;const a=t*10;for(;r.length<t&&o<a;){o++;const h=Math.random()*(e.maxX-e.minX)+e.minX,l=Math.random()*(e.maxZ-e.minZ)+e.minZ,c=new g.Vector3(h,0,l);if(Vi(c,r,i)||s&&!s(c))continue;const m=Yi(),u=m.mesh,{torsoHeight:p,legHeight:y}=m.heightInfo;u.position.copy(c),u.position.y=p/2+y,u.rotation.y=Math.random()*Math.PI*2,d.add(u),r.push(u.position)}console.log(`Attempted to create ${t} statues. Successfully placed ${r.length}.`)}class $i{constructor(t,e){this.scene=t,this.machine=null,this.interactionRadius=2,this.position=new g.Vector3(e.x+5,0,e.z+5),this.isPlayerInRange=!1,this.merchantUI=null,this.currentDiscData=null,this.lastKnownDiscCount=0,this._hasLoggedLoading=!1,this.loadModel(),this.setupKeyListener(),this.initializeMerchantUI(),console.log("Merchant machine initialized at position:",this.position)}async initializeMerchantUI(){const t=async()=>{ot.merchantUI?(this.merchantUI=ot.merchantUI,console.log("MerchantUI successfully initialized")):(console.log("Waiting for MerchantUI to initialize..."),await new Promise(e=>setTimeout(e,100)),await t())};await t()}setupKeyListener(){this.keyHandler=t=>{if(t.key.toLowerCase()==="c"&&mt.canTradeDiscs()){if(console.log("Trade key pressed while in range"),!this.merchantUI){console.log("MerchantUI not yet initialized");return}const e=this.currentDiscData?this.currentDiscData.value:null,i=mt.tradeDisc();console.log("Trade result:",i),e&&k.addMoney(e),i?(console.log("Updating merchant UI with new disc data"),this.currentDiscData=i,this.merchantUI.update(this.currentDiscData)):(this.merchantUI.show(null),this.currentDiscData=null)}},document.addEventListener("keydown",this.keyHandler)}async loadModel(){const t=new Lt;try{const e=await t.loadAsync("assets/models/Machine3.glb");this.machine=e.scene,this.machine.traverse(i=>{i.isMesh&&(console.log("Processing mesh:",i.name),i.name==="Cube001_3"&&(console.log("Applying emissive material to:",i.name),i.material=new g.MeshStandardMaterial({color:16711680,emissive:16711680,emissiveIntensity:5,metalness:0,roughness:.2,toneMapped:!1}),i.material.needsUpdate=!0))}),this.machine.position.copy(this.position),this.scene.add(this.machine),console.log("Merchant machine model loaded successfully")}catch(e){console.error("Error loading merchant machine model:",e)}}getPosition(){return this.position}checkPlayerProximity(t){if(!this.machine){this._hasLoggedLoading||(console.log("Machine model not yet loaded, skipping proximity check"),this._hasLoggedLoading=!0);return}if(this._hasLoggedLoading=!1,!this.merchantUI){console.log("MerchantUI not yet initialized, skipping UI updates");return}const e=this.position.distanceTo(new g.Vector3(t.x,this.position.y,t.z)),i=this.isPlayerInRange;this.isPlayerInRange=e<=this.interactionRadius,this.isPlayerInRange?mt.enableTrading():mt.disableTrading();const n=this.lastKnownDiscCount===0&&k.discCount>0;this.lastKnownDiscCount=k.discCount,this.isPlayerInRange!==i&&(this.isPlayerInRange?(console.log("Player entered merchant machine radius"),console.log("Current disc count:",k.discCount),k.discCount>0?(!this.currentDiscData||n?(this.currentDiscData=mt.generateNewDisc(),console.log("Generated new disc data:",this.currentDiscData)):console.log("Using existing disc data:",this.currentDiscData),this.merchantUI.show(this.currentDiscData)):(console.log("No discs available, showing alternate UI"),this.merchantUI.show(null))):(console.log("Player left merchant machine radius"),this.merchantUI.hide()))}remove(){if(this.machine&&(this.scene.remove(this.machine),this.machine=null),this.merchantUI){this.merchantUI.hide();const t=document.querySelector(".merchant-ui");t&&t.remove()}document.removeEventListener("keydown",this.keyHandler),console.log("Merchant machine and UI removed from scene")}}function Se(d,t,e=3){return t?new g.Vector3(d.x,t.y,d.z).distanceTo(t)<e:!1}class Zi{constructor(t){this.scene=t,this.model=null,this.isActive=!1,this.hasBeenSeen=!1,this.followDistance=6,this.position=new g.Vector3,this.spawnOffset=new g.Vector3,this.loader=new Lt,this.loadMonsterModel()}loadMonsterModel(){console.log(" Attempting to load monster model..."),this.loader.load("assets/models/hollow.glb",t=>{this.model=t.scene,this.model.visible=!1,this.scene.add(this.model),console.log("✅ Monster model loaded successfully!"),this.mixer=new g.AnimationMixer(this.model),this.animations=t.animations},t=>{if(t.lengthComputable){const e=t.loaded/t.total*100;console.log(`📊 Monster model loading progress: ${e.toFixed(2)}%`)}},t=>{console.error("❌ Error loading monster model:",t),console.log("🔍 Make sure the Monster.glb file exists in the /models directory"),this.createFallbackModel()})}createFallbackModel(){console.log("⚠️ Creating fallback cube model for testing...");const t=new g.BoxGeometry(1,2,1),e=new g.MeshPhongMaterial({color:16711680});this.model=new g.Mesh(t,e),this.model.visible=!1,this.scene.add(this.model)}spawn(t,e){if(!this.model||this.isActive)return;const i=t instanceof g.Vector3?t.clone():new g.Vector3(t.x,t.y,t.z),s=(e instanceof g.Vector3?e.clone():new g.Vector3(e.x,e.y,e.z)).normalize().negate(),r=i.clone().add(s.multiplyScalar(this.followDistance));r.y=0,this.spawnOffset.copy(r).sub(i),this.spawnOffset.y=0,this.position.copy(r),this.model.position.copy(r);const o=i.clone().sub(r).normalize(),a=Math.atan2(o.x,o.z);this.model.rotation.y=a,this.model.visible=!0,this.isActive=!0,console.log("👻 Monster spawned at position:",{x:r.x.toFixed(2),y:r.y.toFixed(2),z:r.z.toFixed(2)})}update(t,e){if(!this.isActive||!this.model)return;const n=(t instanceof g.Vector3?t.clone():new g.Vector3(t.x,t.y,t.z)).clone().add(this.spawnOffset);n.y=0,this.position.copy(n),this.model.position.copy(n)}triggerJumpscare(){this.hasBeenSeen||(this.hasBeenSeen=!0,console.log("😱 Triggering jumpscare effect!"),U.stopSoundsBySource("shepards fear"),U.play("scare",{volume:1}),setTimeout(()=>{document.dispatchEvent(new CustomEvent("gameOver"))},1500))}isPlayerLooking(t,e,i=50){if(!this.isActive)return!1;const n=t instanceof g.Vector3?t.clone():new g.Vector3(t.x,0,t.z),s=e instanceof g.Vector3?e.clone():new g.Vector3(e.x,0,e.z),r=this.position.clone().sub(n).normalize(),o=s.normalize().angleTo(r)*(180/Math.PI),a=o<=i;return a&&!this.hasBeenSeen&&console.log("👀 Player has spotted the monster! Angle:",o.toFixed(2),"degrees"),a}}function Ji(d){return new Zi(d)}class Qi{constructor(t,e,i){this.renderer=t,this.scene=e,this.camera=i,this.composer=new Ae(this.renderer);const n=new Te(this.scene,this.camera);this.composer.addPass(n);const s=new De(new g.Vector2(window.innerWidth,window.innerHeight),.5,.1,.35);this.composer.addPass(s),window.addEventListener("resize",()=>this.onWindowResize())}onWindowResize(){const t=window.innerWidth,e=window.innerHeight;this.composer.setSize(t,e)}render(){this.composer.render()}}function Ki(d,t){t.geometry.parameters.width,t.geometry.parameters.height;const e={width:100,height:100},i=2,n=e.width/2+i,s=e.height/2+i,r=240,o={min:5,max:10},a={min:.875,max:1.875},h=.5,l=1.5,c=4,m={min:12.5,max:22.5},u={min:1.5,max:2.75},p=Math.floor(r*.7),y=tn(),x=new g.MeshLambertMaterial({color:4539717,flatShading:!0,side:g.DoubleSide}),f=new g.MeshLambertMaterial({color:3487029,flatShading:!0,side:g.DoubleSide});nn(d,y,f,{halfWidth:n+c,halfHeight:s+c,spikeCount:p,spikeHeight:m,spikeWidth:u,embeddingDepth:h*1.5,positionJitter:l*.7}),en(d,y,x,{halfWidth:n,halfHeight:s,spikeCount:r,spikeHeight:o,spikeWidth:a,embeddingDepth:h,positionJitter:l})}function tn(){const d=new g.BufferGeometry,t=new Float32Array([-.5,0,-.5,.5,0,-.5,0,0,.5,0,1,0]),e=[0,3,1,1,3,2,2,3,0,0,1,2];return d.setAttribute("position",new g.BufferAttribute(t,3)),d.setIndex(e),d.computeVertexNormals(),d}function en(d,t,e,i){const{halfWidth:n,halfHeight:s,spikeCount:r,spikeHeight:o,spikeWidth:a,embeddingDepth:h,positionJitter:l}=i,c=2*(n*2+s*2),m=r/c,u=Math.floor(n*2*m),p=Math.floor(s*2*m);vt(d,t,e,-52,s,n,s,u,o,a,h,l,Math.PI),vt(d,t,e,-52,-52,n,-52,u,o,a,h,l,0),vt(d,t,e,-52,-52,-52,s,p,o,a,h,l,Math.PI*1.5),vt(d,t,e,n,-52,n,s,p,o,a,h,l,Math.PI*.5)}function vt(d,t,e,i,n,s,r,o,a,h,l,c,m){for(let u=0;u<=o*2;u++){const p=u/(o*2);let y=i+(s-i)*p,x=n+(r-n)*p;const f=u%2===0,C=Math.atan2(r-n,s-i)+Math.PI/2;let S;f?S=(Math.random()-.5)*c:S=(Math.random()-.5)*(c*.8)+c*.3,y+=Math.cos(C)*S,x+=Math.sin(C)*S;let b,M;f?(b=Math.random()*(a.max-a.min)+a.min,M=Math.random()*(h.max-h.min)+h.min):(b=Math.random()*(a.max-a.min)*.7+a.min*.9,M=Math.random()*(h.max-h.min)*.7+h.min*.9);const _=new g.Mesh(t,e);_.position.set(y,-.5,x),_.scale.set(M,b,M);const w=m+(Math.random()-.5)*.5;_.rotation.y=w,_.rotation.x=(Math.random()-.5)*.2,_.rotation.z=(Math.random()-.5)*.2,d.add(_)}}function nn(d,t,e,i){const{halfWidth:n,halfHeight:s,spikeCount:r,spikeHeight:o,spikeWidth:a,embeddingDepth:h,positionJitter:l}=i,c=2*(n*2+s*2),m=r/c,u=Math.floor(n*2*m),p=Math.floor(s*2*m);At(d,t,e,-56,s,n,s,u,o,a,h,l,Math.PI),At(d,t,e,-56,-56,n,-56,u,o,a,h,l,0),At(d,t,e,-56,-56,-56,s,p,o,a,h,l,Math.PI*1.5),At(d,t,e,n,-56,n,s,p,o,a,h,l,Math.PI*.5)}function At(d,t,e,i,n,s,r,o,a,h,l,c,m){const u={x:s-i,z:r-n},p=Math.sqrt(u.x*u.x+u.z*u.z),y={x:u.x/p,z:u.z/p},x={x:y.z,z:-y.x};for(let f=0;f<=o;f++){const C=f/o,S=i+(s-i)*C,b=n+(r-n)*C;let M=S+x.x*3,_=b+x.z*3;const w=(Math.random()-.5)*c,H=(Math.random()-.5)*c;M+=w,_+=H;const W=Math.random()*(a.max-a.min)+a.min,P=Math.random()*(h.max-h.min)+h.min,v=new g.Mesh(t,e);v.position.set(M,-.75,_),v.scale.set(P,W,P);const N=m+(Math.random()-.5)*.6;v.rotation.y=N,v.rotation.x=(Math.random()-.5)*.2,v.rotation.z=(Math.random()-.5)*.2,d.add(v)}}class sn{constructor(){this.container=null,this.backgroundImage=null,this.initialized=!1}initialize(){this.initialized||(this.container=document.createElement("div"),this.container.id="game-over-screen",this.container.style.position="fixed",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",this.container.style.height="100%",this.container.style.backgroundColor="black",this.container.style.zIndex="2000",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.justifyContent="center",this.container.style.alignItems="center",this.container.style.opacity="0",this.container.style.transition="opacity 0.5s ease",this.backgroundImage=document.createElement("div"),this.backgroundImage.style.position="absolute",this.backgroundImage.style.top="0",this.backgroundImage.style.left="0",this.backgroundImage.style.width="100%",this.backgroundImage.style.height="100%",this.backgroundImage.style.backgroundImage='url("assets/textures/gameover.png")',this.backgroundImage.style.backgroundSize="cover",this.backgroundImage.style.backgroundPosition="center",this.backgroundImage.style.opacity="0",this.backgroundImage.style.transition="opacity 1.5s ease-in-out",this.backgroundImage.style.zIndex="1",this.contentContainer=document.createElement("div"),this.contentContainer.style.position="relative",this.contentContainer.style.zIndex="2",this.contentContainer.style.display="flex",this.contentContainer.style.flexDirection="column",this.contentContainer.style.alignItems="center",this.contentContainer.style.justifyContent="center",this.contentContainer.style.width="100%",this.contentContainer.style.height="100%",this.gameOverText=document.createElement("h1"),this.gameOverText.textContent="Game Over",this.gameOverText.style.color="white",this.gameOverText.style.fontFamily="monospace",this.gameOverText.style.fontSize="48px",this.gameOverText.style.marginBottom="20px",this.gameOverText.style.opacity="0",this.gameOverText.style.transition="opacity 0.8s ease-in-out",this.gameOverText.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.5)",this.scoreText=document.createElement("p"),this.scoreText.style.color="white",this.scoreText.style.fontFamily="monospace",this.scoreText.style.fontSize="24px",this.scoreText.style.marginBottom="30px",this.scoreText.style.opacity="0",this.scoreText.style.transition="opacity 0.8s ease-in-out",this.scoreText.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.5)",this.playAgainButton=document.createElement("button"),this.playAgainButton.textContent="Play Again",this.playAgainButton.style.padding="10px 20px",this.playAgainButton.style.fontSize="18px",this.playAgainButton.style.backgroundColor="transparent",this.playAgainButton.style.color="white",this.playAgainButton.style.border="2px solid white",this.playAgainButton.style.fontFamily="monospace",this.playAgainButton.style.cursor="pointer",this.playAgainButton.style.opacity="0",this.playAgainButton.style.transition="opacity 0.8s ease-in-out, background-color 0.2s ease",this.playAgainButton.style.textShadow="1px 1px 2px rgba(0, 0, 0, 0.5)",this.playAgainButton.addEventListener("mouseover",()=>{this.playAgainButton.style.backgroundColor="rgba(255, 255, 255, 0.2)"}),this.playAgainButton.addEventListener("mouseout",()=>{this.playAgainButton.style.backgroundColor="transparent"}),this.playAgainButton.addEventListener("click",()=>{this.hide(),window.location.reload()}),this.contentContainer.appendChild(this.gameOverText),this.contentContainer.appendChild(this.scoreText),this.contentContainer.appendChild(this.playAgainButton),this.container.appendChild(this.backgroundImage),this.container.appendChild(this.contentContainer),document.body.appendChild(this.container),this.initialized=!0)}show(){this.initialize(),this.scoreText.textContent=`Score: $${k.money}`,this.container.style.opacity="1",setTimeout(()=>{this.backgroundImage.style.opacity="1",setTimeout(()=>{this.gameOverText.style.opacity="1",setTimeout(()=>{this.scoreText.style.opacity="1",setTimeout(()=>{this.playAgainButton.style.opacity="1"},300)},300)},1e3)},3e3)}hide(){!this.initialized||!this.container||(this.container.style.opacity="0",this.backgroundImage.style.opacity="0",this.gameOverText.style.opacity="0",this.scoreText.style.opacity="0",this.playAgainButton.style.opacity="0",setTimeout(()=>{this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.initialized=!1},1500))}}const on=new sn;class rn{constructor(){this.container=null,this.initialized=!1,this.typingSpeed=10,this.loreText=["With the Final Broadcast came the Collapse, the death of the internet.","Humanity's hunger for entertainment became insatiable.","The scramble for physical media began.","You are a scavenger of our lost history."]}initialize(){if(this.initialized)return;this.container=document.createElement("div"),this.container.id="start-screen",Object.assign(this.container.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",zIndex:"2000",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"});const t=document.createElement("div");Object.assign(t.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:'url("assets/textures/Opening BG.png")',backgroundSize:"cover",backgroundPosition:"center",zIndex:"-1"}),this.container.appendChild(t);const e=document.createElement("div");Object.assign(e.style,{textAlign:"center",marginBottom:"40px"});const i=document.createElement("h1");i.textContent="Rats of Mars",Object.assign(i.style,{color:"white",fontSize:"48px",fontFamily:"monospace",marginBottom:"10px",textShadow:"2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 0 2px 0 #000, 2px 0 0 #000, 0 -2px 0 #000, -2px 0 0 #000"});const n=document.createElement("h2");n.textContent="The Lost Disc",Object.assign(n.style,{color:"white",fontSize:"36px",fontFamily:"monospace",textShadow:"2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 0 2px 0 #000, 2px 0 0 #000, 0 -2px 0 #000, -2px 0 0 #000"}),e.appendChild(i),e.appendChild(n),this.container.appendChild(e);const s=document.createElement("button");s.textContent="Play",Object.assign(s.style,{padding:"15px 40px",fontSize:"24px",backgroundColor:"transparent",color:"white",border:"2px solid white",fontFamily:"monospace",cursor:"pointer",transition:"background-color 0.2s",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.8)"}),s.addEventListener("mouseover",()=>{s.style.backgroundColor="rgba(255, 255, 255, 0.2)"}),s.addEventListener("mouseout",()=>{s.style.backgroundColor="transparent"}),s.addEventListener("click",()=>this.startLoreSequence()),this.container.appendChild(s),document.body.appendChild(this.container),this.initialized=!0}async typewriterEffect(t,e){let i="";const n=document.createElement("span");n.className="typing-text",t.appendChild(n);for(let s=0;s<e.length;s++)i+=e[s],n.textContent=i,await new Promise(r=>setTimeout(r,this.typingSpeed))}async startLoreSequence(){this.container.innerHTML="";const t=document.createElement("div");Object.assign(t.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:'url("assets/textures/Opening BG.png")',backgroundSize:"cover",backgroundPosition:"center",zIndex:"-1"}),this.container.appendChild(t);const e=document.createElement("div");Object.assign(e.style,{color:"white",fontFamily:"monospace",fontSize:"25px",fontWeight:"bold",maxWidth:"80%",textAlign:"center",lineHeight:"2",textShadow:"4px 4px 6px rgba(0, 0, 0, 0.9)"}),this.container.appendChild(e);const i=document.createElement("button");i.textContent="Skip",Object.assign(i.style,{position:"absolute",bottom:"20px",right:"20px",padding:"10px 20px",fontSize:"18px",backgroundColor:"transparent",color:"white",border:"2px solid white",fontFamily:"monospace",cursor:"pointer",transition:"background-color 0.2s",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.8)"}),i.addEventListener("mouseover",()=>{i.style.backgroundColor="rgba(255, 255, 255, 0.2)"}),i.addEventListener("mouseout",()=>{i.style.backgroundColor="transparent"}),i.addEventListener("click",()=>this.startGame()),this.container.appendChild(i);for(const n of this.loreText){const s=document.createElement("div");e.appendChild(s),await this.typewriterEffect(s,n)}setTimeout(()=>this.startGame(),1e4)}startGame(){this.container.style.transition="opacity 1s",this.container.style.opacity="0",setTimeout(()=>{this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.initialized=!1,document.dispatchEvent(new CustomEvent("gameStart"))},1e3)}show(){this.initialize()}}const an=new rn,O=new g.Scene,X=new g.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),L=new g.WebGLRenderer({antialias:!1,powerPreference:"high-performance"});L.setSize(320,240);L.setPixelRatio(1);document.body.appendChild(L.domElement);const ge=new Qi(L,O,X);L.domElement.style.width="100vw";L.domElement.style.height="100vh";L.domElement.style.display="block";L.domElement.style.position="fixed";L.domElement.style.top="0";L.domElement.style.left="0";L.domElement.style.zIndex="1";const{instructions:ke}=gi();ke.style.display="none";an.show();const{controls:B,moveSpeed:fe,keys:D,velocity:J}=ai(X,ke);O.add(B.getObject());let dt=new $i(O,B.getObject().position);console.log("Created merchant machine at start");const xe=["SYSTEM SCAN INITIATED...","Anomaly detected in Sector 7G.","WARNING: Entity proximity increasing.","Memory corruption detected.",`
ERROR: UNKNOWN ORIGIN
SIGNAL LOST...`,"Searching for lost signal...","Atmospheric pressure dropping.","Is anybody out there?","SECURITY ALERT: Perimeter breach.","Running diagnostics..."];function hn(){const d=Math.floor(Math.random()*xe.length);return xe[d]}function ze(){const e=Math.random()*5e3+1e4;setTimeout(()=>{const i=hn();ot.showTerminal(i,6e3),ze()},e)}let qt,Dt;document.addEventListener("gameStart",()=>{console.log("Main.js received gameStart event!"),ze()});document.addEventListener("allDiscsCollected",d=>{console.log("Main.js received allDiscsCollected event!",d.detail)});const Xt=hi(O),ln=1;k.setBoundary(Xt.ground,ln);console.log("Player boundaries set to original 100x100 area. Player movement restricted to x: ±50, z: ±50");console.log("Ground size is 150x150, creating an extended visual area that player cannot access");Ki(O,Xt.ground);console.log("Setting up collectibles and Lost Disc...");(async()=>{try{qt=(await Wi(O)).checkDiscCollection,console.log("Discs setup complete"),Dt=await Li(O),console.log("Lost Disc system initialized")}catch(d){console.error("Error setting up game components:",d)}})();qi(O,d=>!dt||!Se(d,dt.getPosition()));const cn=15,dn={minX:-50,maxX:50,minZ:-50,maxZ:50},un=8;Xi(O,cn,dn,un,X.position.y,d=>!dt||!Se(d,dt.getPosition()));pi(X);X.position.y=1.7;window.addEventListener("resize",()=>{X.aspect=window.innerWidth/window.innerHeight,X.updateProjectionMatrix(),L.setSize(320,240),L.domElement.style.width="100vw",L.domElement.style.height="100vh"});const mn=Ji(O);k.setMonsterReference(mn);D.g=!1;D.h=!1;document.addEventListener("keydown",d=>{switch(d.key.toLowerCase()){case"w":D.w=!0;break;case"a":D.a=!0;break;case"s":D.s=!0;break;case"d":D.d=!0;break}});document.addEventListener("keyup",d=>{switch(d.key.toLowerCase()){case"w":D.w=!1;break;case"a":D.a=!1;break;case"s":D.s=!1;break;case"d":D.d=!1;break}});document.addEventListener("lostDiscEnvironmentChange",()=>{console.log("Changing environment for Lost Disc appearance"),li(O,Xt)});document.addEventListener("spawnMonster",()=>{console.log("Monster spawn event received - Spawning monster"),k.spawnMonster()});document.addEventListener("spawnLostDisc",()=>{console.log("Lost Disc spawn event received but debug mode is off - ignoring")});document.addEventListener("gameOver",()=>{console.log("Game over event received"),Ee=!1,B.isLocked&&B.unlock(),on.show()});let Ee=!0;function ve(){if(requestAnimationFrame(ve),!Ee){ge.render();return}const d=Date.now()*.001;if(B.isLocked){J.x=0,J.z=0,D.w&&(J.z=fe),D.s&&(J.z=-.15),D.a&&(J.x=-.15),D.d&&(J.x=fe),B.moveRight(J.x),B.moveForward(J.z);const t=B.getObject();k.updatePosition(t.position.x,t.position.y,t.position.z),t.position.x=k.position.x,t.position.z=k.position.z;const e=new g.Vector3;X.getWorldDirection(e),k.updateForwardDirection(e.x,e.y,e.z),X.position.y=1.7+Math.sin(d*2)*.01,qt&&qt(B.getObject().position),Dt&&Dt.checkLostDiscCollection&&Dt.checkLostDiscCollection(B.getObject().position),dt&&dt.checkPlayerProximity(B.getObject().position)}Gi(d),be(d),ge.render()}ve();
