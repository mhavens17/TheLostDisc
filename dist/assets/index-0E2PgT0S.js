import*as f from"https://unpkg.com/three@0.152.2/build/three.module.js";import{GLTFLoader as Lt}from"https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js";import{EffectComposer as ve}from"https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as Ae}from"https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as Te}from"https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/UnrealBloomPass.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const we="160",Me=300,$t=1e3,St=1001,Zt=1002,Jt=1003,De=1006,Le=1008,Ie=1009,Fe=1014,Pe=1020,Re=1023,It=1026,Qt=1027,Be=3e3,Ft=3001,Pt="",Rt="srgb",Ne=515,Ct=2e3,Kt=2001;class Vt{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,t);t.target=null}}}const E=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Yt(){const d=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(E[d&255]+E[d>>8&255]+E[d>>16&255]+E[d>>24&255]+"-"+E[t&255]+E[t>>8&255]+"-"+E[t>>16&15|64]+E[t>>24&255]+"-"+E[e&63|128]+E[e>>8&255]+"-"+E[e>>16&255]+E[e>>24&255]+E[s&255]+E[s>>8&255]+E[s>>16&255]+E[s>>24&255]).toLowerCase()}function G(d,t,e){return Math.max(t,Math.min(e,d))}class yt{constructor(t=0,e=0){yt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(G(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*s-r*i+t.x,this.y=n*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xt{constructor(t,e,s,i,n,r,o,a,h){xt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,r,o,a,h)}set(t,e,s,i,n,r,o,a,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=s,l[7]=r,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[3],a=s[6],h=s[1],l=s[4],c=s[7],m=s[2],u=s[5],p=s[8],y=i[0],x=i[3],g=i[6],S=i[1],C=i[4],_=i[7],M=i[2],b=i[5],w=i[8];return n[0]=r*y+o*S+a*M,n[3]=r*x+o*C+a*b,n[6]=r*g+o*_+a*w,n[1]=h*y+l*S+c*M,n[4]=h*x+l*C+c*b,n[7]=h*g+l*_+c*w,n[2]=m*y+u*S+p*M,n[5]=m*x+u*C+p*b,n[8]=m*g+u*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*r*l-e*o*h-s*n*l+s*o*a+i*n*h-i*r*a}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=l*r-o*h,m=o*a-l*n,u=h*n-r*a,p=e*c+s*m+i*u;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/p;return t[0]=c*y,t[1]=(i*h-l*s)*y,t[2]=(o*s-i*r)*y,t[3]=m*y,t[4]=(l*e-i*a)*y,t[5]=(i*n-o*e)*y,t[6]=u*y,t[7]=(s*a-h*e)*y,t[8]=(r*e-s*n)*y,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,r,o){const a=Math.cos(n),h=Math.sin(n);return this.set(s*a,s*h,-s*(a*r+h*o)+r+t,-i*h,i*a,-i*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Bt.makeScale(t,e)),this}rotate(t){return this.premultiply(Bt.makeRotation(-t)),this}translate(t,e){return this.premultiply(Bt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Bt=new xt;function te(d){return document.createElementNS("http://www.w3.org/1999/xhtml",d)}const ee={};function Nt(d){d in ee||(ee[d]=!0,console.warn(d))}function Ut(d){return d<.04045?d*.0773993808:Math.pow(d*.9478672986+.0521327014,2.4)}let rt;class Ue{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{rt===void 0&&(rt=te("canvas")),rt.width=t.width,rt.height=t.height;const s=rt.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=rt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=te("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let r=0;r<n.length;r++)n[r]=Ut(n[r]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Ut(e[s]/255)*255):e[s]=Ut(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Oe=0;class He{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Oe++}),this.uuid=Yt(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let r=0,o=i.length;r<o;r++)i[r].isDataTexture?n.push(Ot(i[r].image)):n.push(Ot(i[r]))}else n=Ot(i);s.url=n}return e||(t.images[this.uuid]=s),s}}function Ot(d){return typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&d instanceof ImageBitmap?Ue.getDataURL(d):d.data?{data:Array.from(d.data),width:d.width,height:d.height,type:d.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let We=0;class J extends Vt{constructor(t=J.DEFAULT_IMAGE,e=J.DEFAULT_MAPPING,s=St,i=St,n=De,r=Le,o=Re,a=Ie,h=J.DEFAULT_ANISOTROPY,l=Pt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:We++}),this.uuid=Yt(),this.name="",this.source=new He(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new yt(0,0),this.repeat=new yt(1,1),this.center=new yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof l=="string"?this.colorSpace=l:(Nt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=l===Ft?Rt:Pt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Me)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case $t:t.x=t.x-Math.floor(t.x);break;case St:t.x=t.x<0?0:1;break;case Zt:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case $t:t.y=t.y-Math.floor(t.y);break;case St:t.y=t.y<0?0:1;break;case Zt:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Nt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Rt?Ft:Be}set encoding(t){Nt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Ft?Rt:Pt}}J.DEFAULT_IMAGE=null;J.DEFAULT_MAPPING=Me;J.DEFAULT_ANISOTROPY=1;class wt{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,r,o){let a=s[i+0],h=s[i+1],l=s[i+2],c=s[i+3];const m=n[r+0],u=n[r+1],p=n[r+2],y=n[r+3];if(o===0){t[e+0]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c;return}if(o===1){t[e+0]=m,t[e+1]=u,t[e+2]=p,t[e+3]=y;return}if(c!==y||a!==m||h!==u||l!==p){let x=1-o;const g=a*m+h*u+l*p+c*y,S=g>=0?1:-1,C=1-g*g;if(C>Number.EPSILON){const M=Math.sqrt(C),b=Math.atan2(M,g*S);x=Math.sin(x*b)/M,o=Math.sin(o*b)/M}const _=o*S;if(a=a*x+m*_,h=h*x+u*_,l=l*x+p*_,c=c*x+y*_,x===1-o){const M=1/Math.sqrt(a*a+h*h+l*l+c*c);a*=M,h*=M,l*=M,c*=M}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,n,r){const o=s[i],a=s[i+1],h=s[i+2],l=s[i+3],c=n[r],m=n[r+1],u=n[r+2],p=n[r+3];return t[e]=o*p+l*c+a*u-h*m,t[e+1]=a*p+l*m+h*c-o*u,t[e+2]=h*p+l*u+o*m-a*c,t[e+3]=l*p-o*c-a*m-h*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(s/2),l=o(i/2),c=o(n/2),m=a(s/2),u=a(i/2),p=a(n/2);switch(r){case"XYZ":this._x=m*l*c+h*u*p,this._y=h*u*c-m*l*p,this._z=h*l*p+m*u*c,this._w=h*l*c-m*u*p;break;case"YXZ":this._x=m*l*c+h*u*p,this._y=h*u*c-m*l*p,this._z=h*l*p-m*u*c,this._w=h*l*c+m*u*p;break;case"ZXY":this._x=m*l*c-h*u*p,this._y=h*u*c+m*l*p,this._z=h*l*p+m*u*c,this._w=h*l*c-m*u*p;break;case"ZYX":this._x=m*l*c-h*u*p,this._y=h*u*c+m*l*p,this._z=h*l*p-m*u*c,this._w=h*l*c+m*u*p;break;case"YZX":this._x=m*l*c+h*u*p,this._y=h*u*c+m*l*p,this._z=h*l*p-m*u*c,this._w=h*l*c-m*u*p;break;case"XZY":this._x=m*l*c-h*u*p,this._y=h*u*c-m*l*p,this._z=h*l*p+m*u*c,this._w=h*l*c+m*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],h=e[2],l=e[6],c=e[10],m=s+o+c;if(m>0){const u=.5/Math.sqrt(m+1);this._w=.25/u,this._x=(l-a)*u,this._y=(n-h)*u,this._z=(r-i)*u}else if(s>o&&s>c){const u=2*Math.sqrt(1+s-o-c);this._w=(l-a)/u,this._x=.25*u,this._y=(i+r)/u,this._z=(n+h)/u}else if(o>c){const u=2*Math.sqrt(1+o-s-c);this._w=(n-h)/u,this._x=(i+r)/u,this._y=.25*u,this._z=(a+l)/u}else{const u=2*Math.sqrt(1+c-s-o);this._w=(r-i)/u,this._x=(n+h)/u,this._y=(a+l)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(G(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=s*l+r*o+i*h-n*a,this._y=i*l+r*a+n*o-s*h,this._z=n*l+r*h+s*a-i*o,this._w=r*l-s*o-i*a-n*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let o=r*t._w+s*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const u=1-e;return this._w=u*r+e*this._w,this._x=u*s+e*this._x,this._y=u*i+e*this._y,this._z=u*n+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),c=Math.sin((1-e)*l)/h,m=Math.sin(e*l)/h;return this._w=r*c+this._w*m,this._x=s*c+this._x*m,this._y=i*c+this._y*m,this._z=n*c+this._z*m,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=Math.random(),e=Math.sqrt(1-t),s=Math.sqrt(t),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(i),s*Math.sin(n),s*Math.cos(n),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class z{constructor(t=0,e=0,s=0){z.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(se.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(se.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,r=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*i-o*s),l=2*(o*e-n*i),c=2*(n*s-r*e);return this.x=e+a*h+r*c-o*l,this.y=s+a*l+o*h-n*c,this.z=i+a*c+n*l-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,r=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*r-s*a,this.z=s*o-i*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return Ht.copy(this).projectOnVector(t),this.sub(Ht)}reflect(t){return this.sub(Ht.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(G(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,s=Math.sqrt(1-t**2);return this.x=s*Math.cos(e),this.y=s*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ht=new z,se=new wt;class V{constructor(t,e,s,i,n,r,o,a,h,l,c,m,u,p,y,x){V.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,r,o,a,h,l,c,m,u,p,y,x)}set(t,e,s,i,n,r,o,a,h,l,c,m,u,p,y,x){const g=this.elements;return g[0]=t,g[4]=e,g[8]=s,g[12]=i,g[1]=n,g[5]=r,g[9]=o,g[13]=a,g[2]=h,g[6]=l,g[10]=c,g[14]=m,g[3]=u,g[7]=p,g[11]=y,g[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new V().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/at.setFromMatrixColumn(t,0).length(),n=1/at.setFromMatrixColumn(t,1).length(),r=1/at.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,r=Math.cos(s),o=Math.sin(s),a=Math.cos(i),h=Math.sin(i),l=Math.cos(n),c=Math.sin(n);if(t.order==="XYZ"){const m=r*l,u=r*c,p=o*l,y=o*c;e[0]=a*l,e[4]=-a*c,e[8]=h,e[1]=u+p*h,e[5]=m-y*h,e[9]=-o*a,e[2]=y-m*h,e[6]=p+u*h,e[10]=r*a}else if(t.order==="YXZ"){const m=a*l,u=a*c,p=h*l,y=h*c;e[0]=m+y*o,e[4]=p*o-u,e[8]=r*h,e[1]=r*c,e[5]=r*l,e[9]=-o,e[2]=u*o-p,e[6]=y+m*o,e[10]=r*a}else if(t.order==="ZXY"){const m=a*l,u=a*c,p=h*l,y=h*c;e[0]=m-y*o,e[4]=-r*c,e[8]=p+u*o,e[1]=u+p*o,e[5]=r*l,e[9]=y-m*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if(t.order==="ZYX"){const m=r*l,u=r*c,p=o*l,y=o*c;e[0]=a*l,e[4]=p*h-u,e[8]=m*h+y,e[1]=a*c,e[5]=y*h+m,e[9]=u*h-p,e[2]=-h,e[6]=o*a,e[10]=r*a}else if(t.order==="YZX"){const m=r*a,u=r*h,p=o*a,y=o*h;e[0]=a*l,e[4]=y-m*c,e[8]=p*c+u,e[1]=c,e[5]=r*l,e[9]=-o*l,e[2]=-h*l,e[6]=u*c+p,e[10]=m-y*c}else if(t.order==="XZY"){const m=r*a,u=r*h,p=o*a,y=o*h;e[0]=a*l,e[4]=-c,e[8]=h*l,e[1]=m*c+y,e[5]=r*l,e[9]=u*c-p,e[2]=p*c-u,e[6]=o*l,e[10]=y*c+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(je,t,Ge)}lookAt(t,e,s){const i=this.elements;return L.subVectors(t,e),L.lengthSq()===0&&(L.z=1),L.normalize(),$.crossVectors(s,L),$.lengthSq()===0&&(Math.abs(s.z)===1?L.x+=1e-4:L.z+=1e-4,L.normalize(),$.crossVectors(s,L)),$.normalize(),kt.crossVectors(L,$),i[0]=$.x,i[4]=kt.x,i[8]=L.x,i[1]=$.y,i[5]=kt.y,i[9]=L.y,i[2]=$.z,i[6]=kt.z,i[10]=L.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[4],a=s[8],h=s[12],l=s[1],c=s[5],m=s[9],u=s[13],p=s[2],y=s[6],x=s[10],g=s[14],S=s[3],C=s[7],_=s[11],M=s[15],b=i[0],w=i[4],O=i[8],H=i[12],I=i[1],v=i[5],B=i[9],X=i[13],Q=i[2],K=i[6],tt=i[10],et=i[14],st=i[3],D=i[7],_t=i[11],bt=i[15];return n[0]=r*b+o*I+a*Q+h*st,n[4]=r*w+o*v+a*K+h*D,n[8]=r*O+o*B+a*tt+h*_t,n[12]=r*H+o*X+a*et+h*bt,n[1]=l*b+c*I+m*Q+u*st,n[5]=l*w+c*v+m*K+u*D,n[9]=l*O+c*B+m*tt+u*_t,n[13]=l*H+c*X+m*et+u*bt,n[2]=p*b+y*I+x*Q+g*st,n[6]=p*w+y*v+x*K+g*D,n[10]=p*O+y*B+x*tt+g*_t,n[14]=p*H+y*X+x*et+g*bt,n[3]=S*b+C*I+_*Q+M*st,n[7]=S*w+C*v+_*K+M*D,n[11]=S*O+C*B+_*tt+M*_t,n[15]=S*H+C*X+_*et+M*bt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],r=t[1],o=t[5],a=t[9],h=t[13],l=t[2],c=t[6],m=t[10],u=t[14],p=t[3],y=t[7],x=t[11],g=t[15];return p*(+n*a*c-i*h*c-n*o*m+s*h*m+i*o*u-s*a*u)+y*(+e*a*u-e*h*m+n*r*m-i*r*u+i*h*l-n*a*l)+x*(+e*h*c-e*o*u-n*r*c+s*r*u+n*o*l-s*h*l)+g*(-i*o*l-e*a*c+e*o*m+i*r*c-s*r*m+s*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=t[9],m=t[10],u=t[11],p=t[12],y=t[13],x=t[14],g=t[15],S=c*x*h-y*m*h+y*a*u-o*x*u-c*a*g+o*m*g,C=p*m*h-l*x*h-p*a*u+r*x*u+l*a*g-r*m*g,_=l*y*h-p*c*h+p*o*u-r*y*u-l*o*g+r*c*g,M=p*c*a-l*y*a-p*o*m+r*y*m+l*o*x-r*c*x,b=e*S+s*C+i*_+n*M;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=S*w,t[1]=(y*m*n-c*x*n-y*i*u+s*x*u+c*i*g-s*m*g)*w,t[2]=(o*x*n-y*a*n+y*i*h-s*x*h-o*i*g+s*a*g)*w,t[3]=(c*a*n-o*m*n-c*i*h+s*m*h+o*i*u-s*a*u)*w,t[4]=C*w,t[5]=(l*x*n-p*m*n+p*i*u-e*x*u-l*i*g+e*m*g)*w,t[6]=(p*a*n-r*x*n-p*i*h+e*x*h+r*i*g-e*a*g)*w,t[7]=(r*m*n-l*a*n+l*i*h-e*m*h-r*i*u+e*a*u)*w,t[8]=_*w,t[9]=(p*c*n-l*y*n-p*s*u+e*y*u+l*s*g-e*c*g)*w,t[10]=(r*y*n-p*o*n+p*s*h-e*y*h-r*s*g+e*o*g)*w,t[11]=(l*o*n-r*c*n-l*s*h+e*c*h+r*s*u-e*o*u)*w,t[12]=M*w,t[13]=(l*y*i-p*c*i+p*s*m-e*y*m-l*s*x+e*c*x)*w,t[14]=(p*o*i-r*y*i-p*s*a+e*y*a+r*s*x-e*o*x)*w,t[15]=(r*c*i-l*o*i+l*s*a-e*c*a-r*s*m+e*o*m)*w,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,r=t.x,o=t.y,a=t.z,h=n*r,l=n*o;return this.set(h*r+s,h*o-i*a,h*a+i*o,0,h*o+i*a,l*o+s,l*a-i*r,0,h*a-i*o,l*a+i*r,n*a*a+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,r){return this.set(1,s,n,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,r=e._y,o=e._z,a=e._w,h=n+n,l=r+r,c=o+o,m=n*h,u=n*l,p=n*c,y=r*l,x=r*c,g=o*c,S=a*h,C=a*l,_=a*c,M=s.x,b=s.y,w=s.z;return i[0]=(1-(y+g))*M,i[1]=(u+_)*M,i[2]=(p-C)*M,i[3]=0,i[4]=(u-_)*b,i[5]=(1-(m+g))*b,i[6]=(x+S)*b,i[7]=0,i[8]=(p+C)*w,i[9]=(x-S)*w,i[10]=(1-(m+y))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=at.set(i[0],i[1],i[2]).length();const r=at.set(i[4],i[5],i[6]).length(),o=at.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],F.copy(this);const h=1/n,l=1/r,c=1/o;return F.elements[0]*=h,F.elements[1]*=h,F.elements[2]*=h,F.elements[4]*=l,F.elements[5]*=l,F.elements[6]*=l,F.elements[8]*=c,F.elements[9]*=c,F.elements[10]*=c,e.setFromRotationMatrix(F),s.x=n,s.y=r,s.z=o,this}makePerspective(t,e,s,i,n,r,o=Ct){const a=this.elements,h=2*n/(e-t),l=2*n/(s-i),c=(e+t)/(e-t),m=(s+i)/(s-i);let u,p;if(o===Ct)u=-(r+n)/(r-n),p=-2*r*n/(r-n);else if(o===Kt)u=-r/(r-n),p=-r*n/(r-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return a[0]=h,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=m,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,s,i,n,r,o=Ct){const a=this.elements,h=1/(e-t),l=1/(s-i),c=1/(r-n),m=(e+t)*h,u=(s+i)*l;let p,y;if(o===Ct)p=(r+n)*c,y=-2*c;else if(o===Kt)p=n*c,y=-1*c;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-m,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=y,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const at=new z,F=new V,je=new z(0,0,0),Ge=new z(1,1,1),$=new z,kt=new z,L=new z,ie=new V,ne=new wt;class Mt{constructor(t=0,e=0,s=0,i=Mt.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],h=i[5],l=i[9],c=i[2],m=i[6],u=i[10];switch(e){case"XYZ":this._y=Math.asin(G(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,u),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(m,h),this._z=0);break;case"YXZ":this._x=Math.asin(-G(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(G(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-G(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(m,u),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(G(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-G(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(m,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return ie.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ie,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ne.setFromEuler(this),this.setFromQuaternion(ne,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Mt.DEFAULT_ORDER="XYZ";class qe{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Ve=0;const oe=new z,ht=new wt,W=new V,zt=new z,ut=new z,Ye=new z,Xe=new wt,re=new z(1,0,0),ae=new z(0,1,0),he=new z(0,0,1),$e={type:"added"},Ze={type:"removed"};class it extends Vt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ve++}),this.uuid=Yt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=it.DEFAULT_UP.clone();const t=new z,e=new Mt,s=new wt,i=new z(1,1,1);function n(){s.setFromEuler(e,!1)}function r(){e.setFromQuaternion(s,void 0,!1)}e._onChange(n),s._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new V},normalMatrix:{value:new xt}}),this.matrix=new V,this.matrixWorld=new V,this.matrixAutoUpdate=it.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=it.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new qe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ht.setFromAxisAngle(t,e),this.quaternion.multiply(ht),this}rotateOnWorldAxis(t,e){return ht.setFromAxisAngle(t,e),this.quaternion.premultiply(ht),this}rotateX(t){return this.rotateOnAxis(re,t)}rotateY(t){return this.rotateOnAxis(ae,t)}rotateZ(t){return this.rotateOnAxis(he,t)}translateOnAxis(t,e){return oe.copy(t).applyQuaternion(this.quaternion),this.position.add(oe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(re,t)}translateY(t){return this.translateOnAxis(ae,t)}translateZ(t){return this.translateOnAxis(he,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(W.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?zt.copy(t):zt.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),ut.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?W.lookAt(ut,zt,this.up):W.lookAt(zt,ut,this.up),this.quaternion.setFromRotationMatrix(W),i&&(W.extractRotation(i.matrixWorld),ht.setFromRotationMatrix(W),this.quaternion.premultiply(ht.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent($e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ze)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),W.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),W.multiply(t.parent.matrixWorld)),t.applyMatrix4(W),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const r=this.children[s].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ut,t,Ye),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ut,Xe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++){const n=e[s];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const i=this.children;for(let n=0,r=i.length;n<r;n++){const o=i[n];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function n(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(t)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const a=o.shapes;if(Array.isArray(a))for(let h=0,l=a.length;h<l;h++){const c=a[h];n(t.shapes,c)}else n(t.shapes,a)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let a=0,h=this.material.length;a<h;a++)o.push(n(t.materials,this.material[a]));i.material=o}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const a=this.animations[o];i.animations.push(n(t.animations,a))}}if(e){const o=r(t.geometries),a=r(t.materials),h=r(t.textures),l=r(t.images),c=r(t.shapes),m=r(t.skeletons),u=r(t.animations),p=r(t.nodes);o.length>0&&(s.geometries=o),a.length>0&&(s.materials=a),h.length>0&&(s.textures=h),l.length>0&&(s.images=l),c.length>0&&(s.shapes=c),m.length>0&&(s.skeletons=m),u.length>0&&(s.animations=u),p.length>0&&(s.nodes=p)}return s.object=i,s;function r(o){const a=[];for(const h in o){const l=o[h];delete l.metadata,a.push(l)}return a}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}it.DEFAULT_UP=new z(0,1,0);it.DEFAULT_MATRIX_AUTO_UPDATE=!0;it.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class Je extends J{constructor(t,e,s,i,n,r,o,a,h,l){if(l=l!==void 0?l:It,l!==It&&l!==Qt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&l===It&&(s=Fe),s===void 0&&l===Qt&&(s=Pe),super(null,i,n,r,o,a,l,s,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:Jt,this.minFilter=a!==void 0?a:Jt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Qe=new Je(1,1);Qe.compareFunction=Ne;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:we}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=we);const lt=new Mt(0,0,0,"YXZ"),ct=new z,Ke={type:"change"},ts={type:"lock"},es={type:"unlock"},le=Math.PI/2;class ss extends Vt{constructor(t,e){super(),this.camera=t,this.domElement=e,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=is.bind(this),this._onPointerlockChange=ns.bind(this),this._onPointerlockError=os.bind(this),this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return this.camera}getDirection(t){return t.set(0,0,-1).applyQuaternion(this.camera.quaternion)}moveForward(t){const e=this.camera;ct.setFromMatrixColumn(e.matrix,0),ct.crossVectors(e.up,ct),e.position.addScaledVector(ct,t)}moveRight(t){const e=this.camera;ct.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(ct,t)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function is(d){if(this.isLocked===!1)return;const t=d.movementX||d.mozMovementX||d.webkitMovementX||0,e=d.movementY||d.mozMovementY||d.webkitMovementY||0,s=this.camera;lt.setFromQuaternion(s.quaternion),lt.y-=t*.002*this.pointerSpeed,lt.x-=e*.002*this.pointerSpeed,lt.x=Math.max(le-this.maxPolarAngle,Math.min(le-this.minPolarAngle,lt.x)),s.quaternion.setFromEuler(lt),this.dispatchEvent(Ke)}function ns(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(ts),this.isLocked=!0):(this.dispatchEvent(es),this.isLocked=!1)}function os(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}function rs(d,t){const e=new ss(d,document.body);let s=!1;const i=.15,n={w:!1,a:!1,s:!1,d:!1},r=new f.Vector3;return document.addEventListener("click",()=>{e.lock()}),e.addEventListener("lock",()=>{if(t.style.display="none",!s){s=!0;const o=new CustomEvent("gameStart");document.dispatchEvent(o),console.log("Game started! Player has clicked to play.")}}),e.addEventListener("unlock",()=>{t.style.display="block"}),document.addEventListener("keydown",o=>{switch(o.code){case"KeyW":n.w=!0;break;case"KeyA":n.a=!0;break;case"KeyS":n.s=!0;break;case"KeyD":n.d=!0;break}}),document.addEventListener("keyup",o=>{switch(o.code){case"KeyW":n.w=!1;break;case"KeyA":n.a=!1;break;case"KeyS":n.s=!1;break;case"KeyD":n.d=!1;break}}),{controls:e,moveSpeed:i,keys:n,velocity:r}}function as(d){d.fog=new f.FogExp2(9145198,.065),d.background=new f.Color(9145198);const t=new f.AmbientLight(8023901,5);d.add(t);const e=new f.DirectionalLight(16752762,1);e.position.set(-1,.2,-.2),d.add(e);const s=new f.PlaneGeometry(150,150),i=new f.MeshLambertMaterial({color:6052941,side:f.DoubleSide}),n=new f.Mesh(s,i);return n.rotation.x=-Math.PI/2,d.add(n),{ground:n,ambientLight:t,directionalLight:e,groundMaterial:i}}function hs(d,t){d.fog.color.setHex(4868698),d.background.setHex(4868698),t.ambientLight.color.setHex(4868698),t.ambientLight.intensity=10,t.directionalLight.color.setHex(6974074),t.directionalLight.intensity=2,t.groundMaterial.color.setHex(2763322)}const ls="modulepreload",cs=function(d){return"/"+d},ce={},ds=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(e.map(a=>{if(a=cs(a),a in ce)return;ce[a]=!0;const h=a.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${l}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":ls,h||(c.as="script"),c.crossOrigin="",c.href=a,o&&c.setAttribute("nonce",o),document.head.appendChild(c),h)return new Promise((m,u)=>{c.addEventListener("load",m),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})}))}function n(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return i.then(r=>{for(const o of r||[])o.status==="rejected"&&n(o.reason);return t().catch(n)})};class us{constructor(){this.sounds={},this.activeSounds=[],this.reducedVolumeSounds=["collect","tick","trade"],this.isGameOver=!1,document.addEventListener("gameOver",()=>{this.stopAllSounds(),this.isGameOver=!0})}loadSound(t,e){const s=new Audio(e);return this.sounds[t]=e,s}playSound(t,e={}){if(this.isGameOver)return null;const s=this.sounds[t]||t,i=new Audio(s),n=e.volume!==void 0?e.volume:1,r=e.randomPitch||!1;let o=n;const a=Object.keys(this.sounds).find(h=>this.sounds[h]===s)||t;return this.reducedVolumeSounds.includes(a)&&(o=n*.5),i.volume=o,r&&(i.playbackRate=.9+Math.random()*.2),i.play().catch(h=>{console.error(`Error playing sound: ${t}`,h);const l=this.activeSounds.indexOf(i);l!==-1&&this.activeSounds.splice(l,1)}),this.activeSounds.push(i),i.addEventListener("ended",()=>{const h=this.activeSounds.indexOf(i);h!==-1&&this.activeSounds.splice(h,1)}),i}stopAllSounds(){console.log(`Stopping all ${this.activeSounds.length} active sounds`);const t=[...this.activeSounds];for(const e of t)e.pause(),e.currentTime=0;this.activeSounds=[]}stopSoundsBySource(t){const e=this.activeSounds.filter(s=>s.src.includes(t));if(e.length>0){console.log(`Stopping ${e.length} sounds matching: ${t}`);for(const s of e){s.pause(),s.currentTime=0;const i=this.activeSounds.indexOf(s);i!==-1&&this.activeSounds.splice(i,1)}}}play(t,e={}){return this.sounds[t]?(e.randomPitch===void 0&&(e.randomPitch=["tick","collect","trade"].includes(t)),this.playSound(t,e)):(console.error(`Sound "${t}" not found. Make sure to load it first.`),null)}}const N=new us;function ms(d){const t=new f.AudioListener;d.add(t);const e=new f.Audio(t),s=new f.AudioLoader;return N.loadSound("tick","assets/sounds/tick.mp3"),N.loadSound("collect","assets/sounds/collect.mp3"),N.loadSound("trade","assets/sounds/trade.mp3"),N.loadSound("scare","assets/sounds/scare.mp3"),N.loadSound("shepardsFear","assets/sounds/shepards fear.mp3"),console.log("Audio system initialized"),{listener:t,ambientSound:e,audioLoader:s}}class ps{constructor(){this.uiContainer=document.createElement("div"),this.uiContainer.id="game-ui-container",this.uiContainer.style.position="fixed",this.uiContainer.style.top="0",this.uiContainer.style.left="0",this.uiContainer.style.width="100%",this.uiContainer.style.height="100%",this.uiContainer.style.pointerEvents="none",this.uiContainer.style.zIndex="100",document.body.appendChild(this.uiContainer),this.terminalElement=null,this.terminalTimeout=null,this.countdownInterval=null,this.countdownElement=null,this.labelTypingSpeed=1,this.contentTypingSpeed=5,this.lastTickTime=0,this.merchantUI=null,this.initializeMerchantUI();const t=document.createElement("style");t.textContent=`
            .typing-text {
                display: inline-block;
            }
            .typing-cursor {
                display: inline-block;
                width: 0.6em;
                height: 1.2em;
                background-color: rgba(255, 255, 255, 0.8);
                vertical-align: middle;
                margin-left: 2px;
                animation: blink 0.7s infinite;
            }
            @keyframes blink {
                0%, 100% { opacity: 1; }
                50% { opacity: 0; }
            }
        `,document.head.appendChild(t),document.addEventListener("showText",e=>{const{message:s,duration:i,position:n,className:r}=e.detail;this.showText(s,i,n,r)}),console.log("UIManager initialized.")}async _loadHTML(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.text(),i=document.createElement("template");i.innerHTML=s.trim();const n=i.content.querySelector("body");return n?n.innerHTML:i.innerHTML}catch(e){return console.error(`Error loading HTML from ${t}:`,e),null}}_injectUI(t,e,s){const i=document.createElement("div");return i.id=e,i.classList.add(s),i.innerHTML=t,this.uiContainer.appendChild(i),i}async showTerminal(t,e=5e3){console.log(`Showing terminal message: "${t}"`),this.terminalTimeout&&(clearTimeout(this.terminalTimeout),this.terminalElement&&this.terminalElement.remove(),this.terminalElement=null);const s=await this._loadHTML("terminal.html");if(!s)return;this.terminalElement=this._injectUI(s,"terminal-ui-instance","terminal-ui");const i=this.terminalElement.querySelector("#terminal-message");i?i.textContent=t:(this.terminalElement.textContent=t,console.warn("Terminal HTML structure might be missing #terminal-message.")),requestAnimationFrame(()=>{setTimeout(()=>{this.terminalElement&&this.terminalElement.classList.add("active")},10)}),this.terminalTimeout=setTimeout(()=>{this.terminalElement&&(this.terminalElement.classList.remove("active"),setTimeout(()=>{this.terminalElement&&(this.terminalElement.remove(),this.terminalElement=null,this.terminalTimeout=null)},500))},e)}async showCountdown(t,e){console.log(`Starting countdown: ${t} seconds.`),this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownElement&&this.countdownElement.remove(),this.countdownElement=null,this.countdownInterval=null);const s=await this._loadHTML("countdown.html");if(!s)return;this.countdownElement=this._injectUI(s,"countdown-ui-instance","countdown-ui");const i=this.countdownElement.querySelector("#countdown-timer");if(!i){console.error("Countdown HTML is missing #countdown-timer."),this.countdownElement&&this.countdownElement.remove(),this.countdownElement=null;return}let n=t,r=!1,o=null,a=!0;const h=()=>{const l=Math.floor(n/60),c=n%60;i.textContent=`${l}:${c.toString().padStart(2,"0")}`,n>0&&Date.now()-this.lastTickTime>=950,n<=0&&!r&&(r=!0,e&&typeof e=="function"&&e(),clearInterval(this.countdownInterval),this.countdownInterval=null,o=setInterval(()=>{a=!a,this.countdownElement&&(this.countdownElement.style.visibility=a?"visible":"hidden")},500),setTimeout(()=>{console.log("13 seconds after countdown reached zero - Auto spawning monster"),document.dispatchEvent(new CustomEvent("spawnMonster")),o&&(clearInterval(o),o=null),this.countdownElement&&(this.countdownElement.classList.remove("active"),setTimeout(()=>{this.countdownElement&&(this.countdownElement.remove(),this.countdownElement=null)},300))},13e3)),r||n--};h(),requestAnimationFrame(()=>{setTimeout(()=>{this.countdownElement&&this.countdownElement.classList.add("active")},10)}),this.countdownInterval=setInterval(h,1e3)}async showText(t,e=3e3,s="top-center",i=null){console.log(`Showing text: "${t}" for ${e}ms`);const n=await this._loadHTML("text.html");if(!n)return;const r=`text-ui-${Date.now()}`,o=this._injectUI(n,r,"text-ui");o.classList.add(s),i&&o.classList.add(i);const a=o.querySelector("#text-message");a?a.textContent=t:(o.textContent=t,console.warn("Text HTML structure might be missing #text-message.")),requestAnimationFrame(()=>{setTimeout(()=>{o.classList.add("active")},10)}),setTimeout(()=>{o.classList.remove("active"),setTimeout(()=>{o.remove()},400)},e)}async initializeMerchantUI(){if(!this.merchantUI){const t=(await ds(async()=>{const{default:e}=await import("./merchant-XSnCxQK-.js");return{default:e}},[])).default;this.merchantUI=new t(this)}}updateMerchantUI(t){this.merchantUI&&this.merchantUI.update(t)}hideMerchantUI(){this.merchantUI&&this.merchantUI.hide()}async typewriterEffect(t,e){return new Promise(s=>{if(!e){s();return}t.textContent="";const i=document.createElement("span");i.className="typing-text";const n=document.createElement("span");n.className="typing-cursor",t.appendChild(i),t.appendChild(n);let r="",o=0;const a=t.classList.contains("merchant-label")?this.labelTypingSpeed:this.contentTypingSpeed,h=()=>{if(o<e.length){const l=e[o];r+=l,i.textContent=r,o++;const c=a*.2,m=a+(Math.random()*c*2-c);requestAnimationFrame(()=>setTimeout(h,m))}else n.remove(),s()};h()})}}const nt=new ps;function ys(d="Click to Start"){const t=nt.uiContainer,e=document.createElement("div");e.id="instructions",e.textContent=d,Object.assign(e.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",fontSize:"36px",fontFamily:"monospace",textAlign:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"10px",cursor:"pointer",pointerEvents:"auto",zIndex:"101"}),t.appendChild(e);const s=document.createElement("div");s.id="disc-counter",Object.assign(s.style,{position:"absolute",top:"10px",left:"10px",color:"white",fontFamily:"monospace",fontSize:"24px",zIndex:"101",pointerEvents:"none",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"}),s.textContent="Discs: 0",t.appendChild(s);const i=document.createElement("div");return i.id="money-counter",Object.assign(i.style,{position:"absolute",top:"40px",left:"10px",color:"white",fontFamily:"monospace",fontSize:"24px",zIndex:"101",pointerEvents:"none",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"}),i.textContent="Assets: $0",t.appendChild(i),console.log("Initial game UI (instructions, counters) set up."),{uiContainer:t,instructions:e,discCounterElement:s,moneyCounterElement:i}}const de={Chill:{genres:["Lo-fi","Chillout","Ambient","Folk","Acoustic","Bossa Nova","Bedroom Pop","City Pop","Jazz","Classical","Synthwave","Vaporwave","Techno","Trance","Dubstep","Drum & Bass","Blues","Funk","Disco","Latin","IDM","Darkwave","8bit"],adjectives:["Smooth","Smoky","Hazy","Faded","Satin","Silk","Blue","Yellow","Purple","Twilight","Slow","Glass","Velvet","Plush","Sleek","Icy","Dusty","Blurry","Solar","Golden","Pale","Soft","Bitter","Lunar","Warm","Fragile","Tidal","Worn","Bare","Strange","Dim","Handwritten","Silver","Topaz","Hidden","Cursive","Wooden","First","Second"],nouns:["Waves","Lights","Evening","Tape","Signal","Clouds","Dreams","Lavender","Sidewalk","Kids","Postcard","Satellites","Ashes","Skylight","Bruises","Matches","Blush","Film","Hometown","Daydream","Polaroid","Smokehalos","Ghost","Train","Marble","Locket","Ceiling","Fireflies","Passenger","Snowglobe","Beach","Ink","Porchlight","Gravel","Fingertips","Moonlight","Lantern","Sleep","Match","Scarf","Silence","Butterfly","Window","Ember","Breeze","Paper","Letter","Closet","Blanket","Bloom","Haze","Key","Spark","Branch","Record","Flicker","Driftwood","September","October","Orbit","Crayon","Pine","Tea","Sparrow","Hummingbird","Venus","Meteor"],title_formats:["[Adjective] [Noun]","[Noun]","[Adjective]","[Adjective] [Noun]","[Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]"],artist_formats:["[Noun]","[Adjective] [Noun]","The [Adjective]","The [Adjective] [Noun]","[Adjective]"]},Sad:{genres:["Midwest Emo","Emo","Slowcore","Blues","Soul","R&B","Gospel","Post-Hardcore","Screamo","Experimental"],adjectives:["Lonely","Hollow","Blue","Desolate","Isolated","Lost","Forsaken","Hopeless","Broken","Bleak","Empty","Cold","Dark","Gray","Quiet","Somber","Haunting","Distant","Dim","Faded","Dying","Late","Old","Crying","Last","Crushed","Torn","Heavy","Foggy","Vacant","Lifeless","Misfit","Invisible","Waning","Buried","Left","First","Second","Small","Hidden","Remote","Modern","Ancient","Flat"],nouns:["Ache","Sorrow","Chair","Couch","Ocean","Regret","Guilt","Dread","Shame","Fog","Cold","Rain","Shadow","Gloom","Haze","Snowfall","Dusk","Goodbye","Memory","Past","Distance","Absence","Yearning","Nostalgia","Loss","Delay","Remains","Separation","Isolation","Window","Scar","Candle","Bed","Mirror","Photograph","Letter","Frame","Ring","Grave","Clock","Train","Suitcase","Locket","Ribbon","Chain","Coin","Key","Mask","Envelope","Compass","Anchor","Flame","Lantern","Blade","Knife","Umbrella","Shell","Stone","Bone","Cat","Painting","Crutch","Sword","Chainmail","Net","Cage","Bridge","Shard","Sun","Moon","Ash","Planet","Ember","Dust","Ink","Record","Gear","Box","Safe","Pluto","Asteroid"],title_formats:["[Adjective] [Noun]","[Noun] of [Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]","[Noun]"],artist_formats:["The [Adjective] [Noun]","The [Adjective] [Noun]","[Noun]","[Adjective]"]},Happy:{genres:["Pop","Disco","Funk","Latin","Bossa Nova","Reggae","Ska","Surf Rock","Alternative","Alt Rock"],adjectives:["Beloved","Bold","Brave","Golden","Holy","Peaceful","Wild","Radiant","Timeless","Silent","Burning","Innocent","Gentle","Fragile","Sacred","Shiny","Warm","Bright","Dreamy","Electric","Surreal","Neon","Cosmic","Lucid","Vivid","Luminous","Hypnotic","Atomic","Vibrant","Sonic","Charged","Icy","Infinite","Chrome","Silver","Sublime","Wavy","Strange","Polar","Slick","Crystalline","Blinding","Amplified","Digital","Searing","Laced","Deep","Midnight","Glacial","Wired","First","Second","Last","Hot"],nouns:["Heart","Love","Days","Sun","Candy","Petal","Apple","Honey","Glow","Shell","Kids","Charm","Lake","Pond","Ocean","Gem","Ruby","Sapphire","Friend","Comet","Cloud","Baby","Locket","Train","Drive","Horizon","Beach","Eyes","Drift","Stone","Fold","Earth","Jupiter"],title_formats:["[Adjective] [Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]","[Noun]"],artist_formats:["The [Adjective] [Noun]","[Adjective]","[Noun]","[Adjective] [Noun]","[Noun] of [Adjective]"]},Edgy:{genres:["Punk","Metal","Noise","Shoegaze","Industrial","Hardcore","Breakcore","Nu-Metal","Math Rock","Black Metal","Grunge","Grungegaze","Post-Punk","Rock"],adjectives:["Blunt","Brutal","Dark","Feral","Flaming","Cold","Hostile","Jaded","Rogue","Toxic","Hollow","Cursed","Bleeding","First","Second","Last","Small","Hidden","Remote","Modern","Ancient","Flat"],nouns:["Leather","Switchblade","Cigarette","Chain","Boots","Skull","Ring","Bike","Mirror","Gas","Mask","Smoke","Blade","Saw","Tag","Denim","Flare","Book","Wire","Ashtray","Claw","Hammer","Bottle","Watch","Bag","Flag","String","Fish","Code","Program","Safe","Shortcut","Scar","Eye","Spider","Star","Chrome","Satellite","Trap","Tooth","Dream","Car","Today","Day","Memory","Space","Shadow","Ceiling","Root","Food","Plastic","Fighter","Disease","Plague","Doctor","Angel","Multiply","Moon","Blur","Moment","Show","Pig","Animal","Cow","Bull","Danger","Neptune","Mercury"],title_formats:["[Adjective] [Noun]","[Noun] of the [Noun]","[Noun]","[Adjective]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]"],artist_formats:["[Noun]","The [Adjective]","[Adjective] [Noun]","[Noun]","The [Adjective] [Noun]","[Adjective] Head","[Adjective]","[Noun] of [Noun]","[Noun] of [Adjective]"]},Angry:{genres:["Hardcore","Trap","Boom Bap","Metal","Grungegaze","Hip-Hop","Crunk","Cloud Rap","Emo Rap","Hyperpop","Mixtape"],adjectives:["Raging","Violent","Explosive","Savage","Vicious","Blazing","First","Second","Last","Thick","Dry","Dirty","Red","Scarlet","Bloody","Large","Heavy","Local","Rare","Common","Normal","Derranged"],nouns:["Fury","War","Punch","Fire","Blade","Enemy","Disease","Dirt","Glass","Knife","Stab","Eclipse","Dog","Wolf","Dragon","Sun","Gas","Belt","Brick","Tile","Pile","Nose","Fan","Clown","Brain","Needle","Scar","Wound","Control","Virus","Chain"],title_formats:["[Adjective] [Noun]","[Noun]","No [Noun]","[Adjective]","[Adjective] [Noun]","[Noun] of [Adjective]"],artist_formats:["[Noun]","[Adjective]","[Noun] of [Noun]","[Noun] of [Adjective]","[Adjective] [Noun]"]}},fs=["Mint","Good","Worn","Damaged","Broken"],gs=["Common","Uncommon","Rare","Cult Classic","Illegal"],xs={Mint:5,Good:25,Worn:40,Damaged:20,Broken:10},ws={Common:50,Uncommon:25,Rare:15,"Cult Classic":7,Illegal:3},Ms={Mint:1,Good:.8,Worn:.6,Damaged:.4,Broken:.2},_s={Common:1,Uncommon:2,Rare:4,"Cult Classic":8,Illegal:16};function bs(d,t){const s=(Math.floor(Math.random()*91)+10)*Ms[d]*_s[t],i=.8+Math.random()*.4;return Math.floor(s*i)}function q(d){return d[Math.floor(Math.random()*d.length)]}function ue(d,t){let e=d;return e=e.replace(/\[Adjective\]/g,()=>q(t.adjectives)),e=e.replace(/\[Noun\]/g,()=>q(t.nouns)),e=e.replace(/\[Nouns\]/g,()=>q(t.nouns)+"s"),e}function me(d,t){const e=Object.values(t).reduce((i,n)=>i+n,0);let s=Math.random()*e;for(let i=0;i<d.length;i++)if(s-=t[d[i]],s<=0)return d[i];return d[0]}function Ss(d,t,e,s,i,n){const r={Mint:{Common:["Still sealed. Huh. Probably worth more than me.","Looks fresh out the bin. Some poor soul never got to play it.","Not a scratch. Either you got lucky or you're better at digging than most.","Factory-new? In this dustpile? I'm shocked."],Uncommon:["Mint condition. Makes my circuits purr.","Pristine like a priest's lie. Rare find, this.","Like it was born yesterday. I almost feel bad taking it from you.","No dust, no scars... no soul. But pretty, I'll give it that."],Rare:["Mint. You know what you've got, right?","Perfect shape. Almost makes me forget we're buried in ash.","Not a nick. This one lived a better life than I did.","Pristine. Like someone preserved it for the second coming."],"Cult Classic":["Mint. If I had a heart, it'd skip a beat.","Flawless. This was someone's religion once.","So clean it hurts. Hurts like memory.","Like it was waiting for the right hands. Yours, apparently."],Illegal:["Mint and forbidden. Dangerous combo.","Pristine sin. Hope you've got somewhere to hide it.","Flawless and flagged. Even I wouldn't risk playing this one.","You know what this is. And now I know you know."]},Good:{Common:["Good shape. Plays fine, if you ignore the ghosts.","Minor scuffs. Adds character.","Solid condition. Could survive another apocalypse.","Not bad. Probably passed through a dozen hands and kept its dignity."],Uncommon:["Decent find. Might even be authentic.","Little worn, still proud. Like an old soldier.","Better than most of what people bring me.","You've got a nose for quality, I'll give you that."],Rare:["Still breathin'. That's more than I can say for most things.","A little scratched, a lot precious.","Rarity like this doesn't care about blemishes.","This one's seen things. It remembers."],"Cult Classic":["Magic's still in there. You can smell it.","A bit worn, but it hums. Listen close.","This disc meant something. Still does.","You don't find these—you're called to them."],Illegal:["Good shape. Bad karma.","You touch this, you risk waking up somewhere you don't recognize.","The less we say about this, the better. Nod if you understand.","Still dangerous. Maybe more so now that it's wounded."]},Worn:{Common:["Worn down like the rest of us.","Seen better days. Haven't we all?","Still standing. That's what counts.","Rough around the edges. Like most survivors."],Uncommon:["Not much to look at, but there's a heartbeat in there.","Weathered. That's history in your hands.","Keeps spinning. That's more than I expected.","Scarred, but not silent."],Rare:["This one crawled through the mud to find you.","Hurt, but honest. I respect that.","Bruised treasure. Let's not waste it.","Fell far to get here. Don't drop it again."],"Cult Classic":["It's bled for meaning. Still bleeding.","Ragged edge. Holy core.","Legend never needed polish.","It's ugly. And it's perfect."],Illegal:["Worn outlaw tech. They'd gut you for this.","If you value silence, don't let anyone else see it.","Torn from the void. Left a scar.","Dangerous even in pieces. Treat with respect—or fear."]},Damaged:{Common:["Cracked, but talkative.","Might squeal when played. Don't blame me.","Falling apart, but desperate to be remembered.","Not pretty, but it wants to be seen."],Uncommon:["Bit rough. Still sings.","Looks worse than it sounds. Maybe.","Not worthless, just misunderstood.","Hurt, but holding."],Rare:["Barely breathing. Still sacred.","Scraped up survivor. You're in good company.","Damage makes it real."],"Cult Classic":["Wounded worship. Handle with reverence.","Still holy. Even bruised.","Scars like these tell tales.","It's lived. That's what makes it matter."],Illegal:["Bad news in a cracked shell.","One glance and the wrong eyes would hunt you.","Still pulsing with secrets.","Don't keep it near your heart."]},Broken:{Common:["Dead tech. Nice paperweight, though.","Doesn't play. Still makes noise if you listen hard enough.","Totally busted. But someone once cared about it.","Worthless... or is it? Nah. Probably worthless."],Uncommon:["Broken, but full of ghosts.","You could try to fix it. Or mourn it.","Ruined, but not forgotten.","It cracked open. Something escaped."],Rare:["Even shattered, this one demands attention.","Broken relic. Dangerous beauty.","Dust and splinters. And memory.","Destroyed. But you can still feel the heat."],"Cult Classic":["Legends don't die. They fracture.","Shattered, but it hums in another frequency.","If you dream hard enough, you'll hear it again.","Broken altar to a forgotten god."],Illegal:["Even dead, it's outlawed.","You're braver than you look, holding this.","This shouldn't exist. And yet...","Throw it in the fire. Or keep it. Your call."]}},o={Illegal:{Broken:["Dead as a ghost, but still illegal. The signal never really dies.","Doesn't function. Still dangerous. That's power.","Shattered, but the kind that echoes in forbidden channels.","Non-functional? Tell that to the black vans parked outside."],Damaged:["It limps. It leaks. It shouldn't be here.","Still pings hidden frequencies. I heard them last night.","Wounded and wrong. But priceless in the underworld.","You didn't find this. It found you."]},"Cult Classic":{Broken:["Broken, but this was gospel once.","Doesn't spin, but it still chants.","It's more shrine than disc now.","A relic shattered, not erased."],Damaged:["Scuffed, but every mark tells a myth.","Worn edges, timeless core.","Flickering magic. Still alive in there.","This one's legacy outweighs its wounds."]}};return o[t]&&o[t][d]?q(o[t][d]):q(r[d][t])}function Cs(){const d=q(Object.keys(de)),t=de[d],e=q(t.genres),s=ue(q(t.artist_formats),t),i=ue(q(t.title_formats),t),n=me(fs,xs),r=me(gs,ws),o=bs(n,r);return{title:i,artist:s,genre:e,value:`$${o}`,condition:n,rarity:r,quote:Ss(n,r)}}class ks{constructor(){this.currentDiscData=null,this._canTrade=!1,this.soldDiscsCount=0}getDiscCount(){return k.discCount}enableTrading(){this._canTrade=!0}disableTrading(){this._canTrade=!1}canTradeDiscs(){return this._canTrade&&k.discCount>0}updateDiscCounter(){const t=document.getElementById("disc-counter");t&&(t.textContent=`Discs: ${k.discCount}`)}generateNewDisc(){return console.log("Attempting to generate new disc. Current count:",k.discCount),k.discCount>0?(this.currentDiscData=Cs(),console.log("Generated new disc data:",this.currentDiscData),this.currentDiscData):(console.log("No discs available for generation"),null)}tradeDisc(){if(console.log("Attempting to trade disc. Can trade:",this._canTrade,"Count:",k.discCount),this._canTrade&&k.discCount>0){k.discCount--,this.updateDiscCounter();const t=this.generateNewDisc();return N.play("trade",{randomPitch:!0}),this.soldDiscsCount++,this.soldDiscsCount===15&&(console.log("15th disc sold - Initiating final sequence"),document.dispatchEvent(new CustomEvent("finalSequenceStart"))),console.log("Traded disc. New count:",k.discCount,"Total sold:",this.soldDiscsCount),t}return console.log("Trade failed: trading disabled or no discs available"),null}}const mt=new ks;class zs{constructor(){this._discCount=0,this._money=0,this.position={x:0,y:0,z:0},this.forward={x:0,y:0,z:-1},this.monster=null,this.updateMoneyDisplay(),this.boundary={minX:-50,maxX:50,minZ:-50,maxZ:50}}get discCount(){return this._discCount}set discCount(t){this._discCount=t;const e=document.getElementById("disc-counter");e&&(e.textContent=`Discs: ${this._discCount}`)}get money(){return this._money}set money(t){this._money=t,this.updateMoneyDisplay()}addMoney(t){const e=typeof t=="string"?parseInt(t.replace(/\$/,"")):t;isNaN(e)?console.error("Invalid money value:",t):(this._money+=e,console.log("Added money:",e,"New total:",this._money),this.updateMoneyDisplay())}collectDisc(){this.discCount++,console.log("Player collected disc. New count:",this.discCount)}setBoundary(t,e=0){this.boundary={minX:-50+e,maxX:100/2-e,minZ:-50+e,maxZ:100/2-e},this.originalBoundary={xRange:"±50",zRange:"±50",actualMinX:-50+e,actualMaxX:50-e,actualMinZ:-50+e,actualMaxZ:50-e},console.log("Player boundaries set:",this.boundary)}clampPositionToBoundary(t,e){const s=Math.max(this.boundary.minX,Math.min(this.boundary.maxX,t)),i=Math.max(this.boundary.minZ,Math.min(this.boundary.maxZ,e));return{x:s,z:i}}updatePosition(t,e,s){const i=this.clampPositionToBoundary(t,s);this.position.x=i.x,this.position.y=e,this.position.z=i.z,this.monster&&this.monster.isActive&&(this.monster.update(this.position,this.forward),this.checkMonsterVisibility())}updateForwardDirection(t,e,s){this.forward={x:t,y:e,z:s}}setMonsterReference(t){this.monster=t}spawnMonster(){this.monster&&!this.monster.isActive&&this.monster.spawn(this.position,this.forward)}checkMonsterVisibility(){!this.monster||!this.monster.isActive||this.monster.isPlayerLooking(this.position,this.forward)&&this.monster.triggerJumpscare()}updateMoneyDisplay(){const t=document.getElementById("money-counter");t&&(t.textContent=`Assets: $${this._money}`)}}const k=new zs;class Es{constructor(){this.isActive=!1,this.monsterSpawned=!1,document.addEventListener("spawnMonster",()=>{this.monsterSpawned=!0})}startFinalSequence(){this.isActive||(this.isActive=!0,this.monsterSpawned=!1,nt.showCountdown(120,()=>{console.log("Countdown finished - Zero reached")}),setTimeout(()=>{console.log("Playing Shepard's Fear"),N.play("shepardsFear",{volume:.9})},3e4))}}const vs=new Es,As=1,Gt=2;let A=null,ft=null,Wt=null;function Ts(){return new Promise((d,t)=>{Wt||(Wt=new Lt),Wt.load("assets/models/CD.glb",e=>{ft=e.scene.clone(),ft.traverse(s=>{if(s.isMesh){const i=s.material,n=new f.MeshStandardMaterial({map:i.map,emissive:16711680,emissiveIntensity:5,metalness:0,roughness:1});s.material=n}}),console.log("✅ Lost Disc model loaded successfully with red glow effect!"),d(ft)},e=>{if(e.lengthComputable){const s=e.loaded/e.total*100;console.log(`📊 Lost Disc model loading progress: ${s.toFixed(2)}%`)}},e=>{console.error("❌ Error loading Lost Disc model:",e),t(e)})})}async function Ds(d){new Audio("assets/sounds/shepards fear.mp3");try{await Ts()}catch(t){console.error("Failed to load lost disc model:",t)}return document.addEventListener("finalSequenceStart",()=>{console.log("Final sequence started - spawning Lost Disc"),Is(d)}),document.addEventListener("keydown",t=>{t.key.toLowerCase()==="h"&&(console.log("Debug key (H) pressed - Triggering final sequence"),document.dispatchEvent(new CustomEvent("finalSequenceStart")))}),{checkLostDiscCollection:Fs,animateLostDisc:_e,setNormalDiscs:Ls}}function Ls(d){}function Is(d){if(A)return;const t=f.MathUtils.randFloat(-50,50),e=f.MathUtils.randFloat(-50,50);ft?(A=ft.clone(),A.position.set(t,Gt,e),A.rotation.x=Math.PI/2,d.add(A),console.log("Lost Disc spawned at:",t,Gt,e),nt.showText("THE LOST DISC HAS APPEARED",3e3,"top-center","lost-disc"),document.dispatchEvent(new CustomEvent("lostDiscEnvironmentChange"))):console.error("Failed to spawn Lost Disc: model not loaded")}function Fs(d){if(!A)return;Math.sqrt(Math.pow(d.x-A.position.x,2)+Math.pow(d.z-A.position.z,2))<As&&(A.parent.remove(A),A=null,console.log("Lost Disc collected - Starting final countdown"),vs.startFinalSequence())}function _e(d){A&&(A.rotation.z=d*4,A.position.y=Gt+Math.sin(d*2)*.1,A.traverse(t=>{if(t.isMesh&&t.material&&t.material.emissiveIntensity!==void 0){const e=4+(Math.sin(d*3)*1.5+1.5);t.material.emissiveIntensity=e,t.material.needsUpdate=!0}}))}const Ps=20,Rs=1,pe=5,Et={minX:-50,maxX:50,minZ:-50,maxZ:50},Bs=new f.Vector3(0,0,0),Ns=5,ye=10;let gt=null;const T=[];let pt=null,jt=null;function Us(){return new Promise((d,t)=>{jt||(jt=new Lt),jt.load("assets/models/CD.glb",e=>{pt=e.scene.clone(),pt.scale.set(1,1,1),pt.traverse(s=>{if(s.isMesh){const i=s.material,n=new f.MeshStandardMaterial({map:i.map,emissive:14913298,emissiveIntensity:5,metalness:0,roughness:1});s.material=n}}),console.log("✅ CD model loaded successfully with glow effect!"),d(pt)},e=>{if(e.lengthComputable){const s=e.loaded/e.total*100;console.log(`📊 CD model loading progress: ${s.toFixed(2)}%`)}},e=>{console.error("❌ Error loading CD model:",e),t(e)})})}function be(){let t=0;for(;t<50;){const e=f.MathUtils.randFloat(Et.minX,Et.maxX),s=f.MathUtils.randFloat(Et.minZ,Et.maxZ),i=.5,n=new f.Vector3(e,i,s);if(n.distanceTo(Bs)<pe){t++;continue}let r=!1;for(const o of T)if(n.distanceTo(o.position)<pe){r=!0;break}if(!r)return console.log(`Found valid disc position at (${e.toFixed(2)}, ${i}, ${s.toFixed(2)})`),n;t++}return console.log("Failed to find valid position after 50 attempts"),null}function Se(d,t){const e=pt.clone();e.position.copy(t),e.rotation.x=Math.PI/2,d.add(e),T.push(e),console.log(`Spawned disc at (${t.x.toFixed(2)}, ${t.y}, ${t.z.toFixed(2)})`)}function Os(d){if(T.length<=Ns){console.log(`Disc count (${T.length}) below threshold, spawning ${ye} new discs`);let t=0;for(let e=0;e<ye;e++){const s=be();s&&(Se(d,s),t++)}t>0?console.log(`Successfully spawned ${t} new discs. Total discs now: ${T.length}`):console.log("Failed to spawn any new discs - no valid positions found")}}function Tt(){gt&&(gt.textContent=`Discs: ${k.discCount}`)}async function Hs(d){k.discCount=0,gt=document.getElementById("disc-counter"),gt?Tt():console.error("Disc counter element (#disc-counter) not found in the DOM. Make sure setupGameUI runs first.");try{await Us()}catch(t){return console.error("Failed to load disc model:",t),{discs:[],checkDiscCollection:()=>{},updateDiscCounter:Tt}}for(let t=0;t<Ps;t++){const e=be();e&&Se(d,e)}return console.log(`Created ${T.length} collectible discs`),{discs:T,checkDiscCollection:Ws,updateDiscCounter:Tt}}function Ws(d){if(!gt||T.length===0)return;let t=!1,e=null;for(let s=T.length-1;s>=0;s--){const i=T[s];if(!i||!i.parent){T.splice(s,1);continue}!e&&i.parent&&(e=i.parent),Math.sqrt(Math.pow(d.x-i.position.x,2)+Math.pow(d.z-i.position.z,2))<Rs&&(i.parent.remove(i),T.splice(s,1),k.collectDisc(),t=!0,N.play("collect",{randomPitch:!0}),nt.showText("Disc Acquired!",2e3,"top-center"))}t&&(Tt(),console.log(`Current disc count: ${T.length}`),e&&Os(e))}function js(d){for(const t of T)if(t.rotation.z=d*3,t.traverse(e=>{if(e.isMesh&&e.material&&e.material.emissiveIntensity!==void 0){const s=.3+(Math.sin(d*2)*.25+.25);e.material.emissiveIntensity=s,e.material.needsUpdate=!0}}),t.userData.light){const e=.5+(Math.sin(d*2)*.25+.25);t.userData.light.intensity=e}}function Gs(d,t=null){for(let i=0;i<3;i++){let r=function(o,a){const h=new f.Group,l=4868668,c=6+Math.floor(Math.random()*4);for(let m=0;m<c;m++){const u=.7+Math.random()*.8,p=new f.BoxGeometry(.08,u,.08),y=new f.Color(l).offsetHSL(0,0,(Math.random()-.5)*.1),x=new f.MeshLambertMaterial({color:y}),g=new f.Mesh(p,x),S=m/c*Math.PI*2+(Math.random()-.5)*.5,C=.3+Math.random()*Math.PI*.25;g.position.y=0,g.rotation.order="YXZ",g.rotation.y=S,g.rotation.x=C;const _=.1;g.position.x=Math.cos(S)*_*Math.random(),g.position.z=Math.sin(S)*_*Math.random(),h.add(g)}h.position.set(o,0,a),d.add(h)};const n=new f.Vector3((Math.random()-.5)*100*2,0,(Math.random()-.5)*100*2);if(!(t&&!t(n)))for(let o=0;o<50;o++){const a=(Math.random()-.5)*80,h=(Math.random()-.5)*80;r(a,h)}}}const j=new f.MeshLambertMaterial({color:11184810});function qs(d,t,e){const s=new f.Vector3(0,d.y,0);if(d.distanceTo(s)<e)return!0;for(const i of t)if(Math.sqrt(Math.pow(d.x-i.x,2)+Math.pow(d.z-i.z,2))<e)return!0;return!1}function Vs(){const d=f.MathUtils.randFloat(1,1.4),t=f.MathUtils.randFloat(.6,.8),e=t*.5,s=f.MathUtils.randFloat(.9,1.3),i=t*.2,n=i,r=d*.8,o=t*.15,a=o,h=f.MathUtils.randFloat(.4,.5),l=.15,c=h*.6,m=t*.2,u=m,p=u,y=new f.BoxGeometry(t,d,e),x=new f.BoxGeometry(h,h,h),g=new f.BoxGeometry(c,l,c),S=new f.BoxGeometry(i,s,n),C=new f.BoxGeometry(o,r,a);C.translate(0,r/2,0);const _=new f.BoxGeometry(m,u,p),M=new f.Mesh(y,j),b=new f.Mesh(x,j),w=new f.Mesh(g,j),O=new f.Mesh(S,j),H=new f.Mesh(S,j),I=new f.Mesh(C,j),v=new f.Mesh(C,j),B=new f.Mesh(_,j),X=new f.Mesh(_,j);w.position.y=d/2+l/2,b.position.y=w.position.y+l/2+h/2;const Q=t/2+m/2,K=d/2-u/2;B.position.set(-Q,K,0),X.position.set(Q,K,0);const tt=-u/2;B.add(I),X.add(v),I.position.set(0,tt,0),I.rotation.x=f.MathUtils.degToRad(10),v.position.set(0,tt,0),v.rotation.x=f.MathUtils.degToRad(10);const et=t/2-i/2-.05,st=-(d/2+s/2);O.position.set(-et,st,0),H.position.set(et,st,0);const D=new f.Group;return D.add(M),D.add(b),D.add(w),D.add(B),D.add(X),D.add(O),D.add(H),{mesh:D,heightInfo:{torsoHeight:d,legHeight:s}}}function Ys(d,t,e,s,i,n=null){const r=[];let o=0;const a=t*10;for(;r.length<t&&o<a;){o++;const h=Math.random()*(e.maxX-e.minX)+e.minX,l=Math.random()*(e.maxZ-e.minZ)+e.minZ,c=new f.Vector3(h,0,l);if(qs(c,r,s)||n&&!n(c))continue;const m=Vs(),u=m.mesh,{torsoHeight:p,legHeight:y}=m.heightInfo;u.position.copy(c),u.position.y=p/2+y,u.rotation.y=Math.random()*Math.PI*2,d.add(u),r.push(u.position)}console.log(`Attempted to create ${t} statues. Successfully placed ${r.length}.`)}class Xs{constructor(t,e){this.scene=t,this.machine=null,this.interactionRadius=2,this.position=new f.Vector3(e.x+5,0,e.z+5),this.isPlayerInRange=!1,this.merchantUI=null,this.currentDiscData=null,this.lastKnownDiscCount=0,this._hasLoggedLoading=!1,this.loadModel(),this.setupKeyListener(),this.initializeMerchantUI(),console.log("Merchant machine initialized at position:",this.position)}async initializeMerchantUI(){const t=async()=>{nt.merchantUI?(this.merchantUI=nt.merchantUI,console.log("MerchantUI successfully initialized")):(console.log("Waiting for MerchantUI to initialize..."),await new Promise(e=>setTimeout(e,100)),await t())};await t()}setupKeyListener(){this.keyHandler=t=>{if(t.key.toLowerCase()==="c"&&mt.canTradeDiscs()){if(console.log("Trade key pressed while in range"),!this.merchantUI){console.log("MerchantUI not yet initialized");return}const e=this.currentDiscData?this.currentDiscData.value:null,s=mt.tradeDisc();console.log("Trade result:",s),e&&k.addMoney(e),s?(console.log("Updating merchant UI with new disc data"),this.currentDiscData=s,this.merchantUI.update(this.currentDiscData)):(this.merchantUI.show(null),this.currentDiscData=null)}},document.addEventListener("keydown",this.keyHandler)}async loadModel(){const t=new Lt;try{const e=await t.loadAsync("assets/models/Machine3.glb");this.machine=e.scene,this.machine.traverse(s=>{s.isMesh&&(console.log("Processing mesh:",s.name),s.name==="Cube001_3"&&(console.log("Applying emissive material to:",s.name),s.material=new f.MeshStandardMaterial({color:16711680,emissive:16711680,emissiveIntensity:5,metalness:0,roughness:.2,toneMapped:!1}),s.material.needsUpdate=!0))}),this.machine.position.copy(this.position),this.scene.add(this.machine),console.log("Merchant machine model loaded successfully")}catch(e){console.error("Error loading merchant machine model:",e)}}getPosition(){return this.position}checkPlayerProximity(t){if(!this.machine){this._hasLoggedLoading||(console.log("Machine model not yet loaded, skipping proximity check"),this._hasLoggedLoading=!0);return}if(this._hasLoggedLoading=!1,!this.merchantUI){console.log("MerchantUI not yet initialized, skipping UI updates");return}const e=this.position.distanceTo(new f.Vector3(t.x,this.position.y,t.z)),s=this.isPlayerInRange;this.isPlayerInRange=e<=this.interactionRadius,this.isPlayerInRange?mt.enableTrading():mt.disableTrading();const i=this.lastKnownDiscCount===0&&k.discCount>0;this.lastKnownDiscCount=k.discCount,this.isPlayerInRange!==s&&(this.isPlayerInRange?(console.log("Player entered merchant machine radius"),console.log("Current disc count:",k.discCount),k.discCount>0?(!this.currentDiscData||i?(this.currentDiscData=mt.generateNewDisc(),console.log("Generated new disc data:",this.currentDiscData)):console.log("Using existing disc data:",this.currentDiscData),this.merchantUI.show(this.currentDiscData)):(console.log("No discs available, showing alternate UI"),this.merchantUI.show(null))):(console.log("Player left merchant machine radius"),this.merchantUI.hide()))}remove(){if(this.machine&&(this.scene.remove(this.machine),this.machine=null),this.merchantUI){this.merchantUI.hide();const t=document.querySelector(".merchant-ui");t&&t.remove()}document.removeEventListener("keydown",this.keyHandler),console.log("Merchant machine and UI removed from scene")}}function Ce(d,t,e=3){return t?new f.Vector3(d.x,t.y,d.z).distanceTo(t)<e:!1}class $s{constructor(t){this.scene=t,this.model=null,this.isActive=!1,this.hasBeenSeen=!1,this.followDistance=6,this.position=new f.Vector3,this.spawnOffset=new f.Vector3,this.loader=new Lt,this.loadMonsterModel()}loadMonsterModel(){console.log(" Attempting to load monster model..."),this.loader.load("assets/models/hollow.glb",t=>{this.model=t.scene,this.model.visible=!1,this.scene.add(this.model),console.log("✅ Monster model loaded successfully!"),this.mixer=new f.AnimationMixer(this.model),this.animations=t.animations},t=>{if(t.lengthComputable){const e=t.loaded/t.total*100;console.log(`📊 Monster model loading progress: ${e.toFixed(2)}%`)}},t=>{console.error("❌ Error loading monster model:",t),console.log("🔍 Make sure the Monster.glb file exists in the /models directory"),this.createFallbackModel()})}createFallbackModel(){console.log("⚠️ Creating fallback cube model for testing...");const t=new f.BoxGeometry(1,2,1),e=new f.MeshPhongMaterial({color:16711680});this.model=new f.Mesh(t,e),this.model.visible=!1,this.scene.add(this.model)}spawn(t,e){if(!this.model||this.isActive)return;const s=t instanceof f.Vector3?t.clone():new f.Vector3(t.x,t.y,t.z),n=(e instanceof f.Vector3?e.clone():new f.Vector3(e.x,e.y,e.z)).normalize().negate(),r=s.clone().add(n.multiplyScalar(this.followDistance));r.y=0,this.spawnOffset.copy(r).sub(s),this.spawnOffset.y=0,this.position.copy(r),this.model.position.copy(r);const o=s.clone().sub(r).normalize(),a=Math.atan2(o.x,o.z);this.model.rotation.y=a,this.model.visible=!0,this.isActive=!0,console.log("👻 Monster spawned at position:",{x:r.x.toFixed(2),y:r.y.toFixed(2),z:r.z.toFixed(2)})}update(t,e){if(!this.isActive||!this.model)return;const i=(t instanceof f.Vector3?t.clone():new f.Vector3(t.x,t.y,t.z)).clone().add(this.spawnOffset);i.y=0,this.position.copy(i),this.model.position.copy(i)}triggerJumpscare(){this.hasBeenSeen||(this.hasBeenSeen=!0,console.log("😱 Triggering jumpscare effect!"),N.stopSoundsBySource("shepards fear"),N.play("scare",{volume:1}),setTimeout(()=>{document.dispatchEvent(new CustomEvent("gameOver"))},1500))}isPlayerLooking(t,e,s=30){if(!this.isActive)return!1;const i=t instanceof f.Vector3?t.clone():new f.Vector3(t.x,0,t.z),n=e instanceof f.Vector3?e.clone():new f.Vector3(e.x,0,e.z),r=this.position.clone().sub(i).normalize(),o=n.normalize().angleTo(r)*(180/Math.PI),a=o<=s;return a&&!this.hasBeenSeen&&console.log("👀 Player has spotted the monster! Angle:",o.toFixed(2),"degrees"),a}}function Zs(d){return new $s(d)}class Js{constructor(t,e,s){this.renderer=t,this.scene=e,this.camera=s,this.composer=new ve(this.renderer);const i=new Ae(this.scene,this.camera);this.composer.addPass(i);const n=new Te(new f.Vector2(window.innerWidth,window.innerHeight),.5,.1,.35);this.composer.addPass(n),window.addEventListener("resize",()=>this.onWindowResize())}onWindowResize(){const t=window.innerWidth,e=window.innerHeight;this.composer.setSize(t,e)}render(){this.composer.render()}}function Qs(d,t){t.geometry.parameters.width,t.geometry.parameters.height;const e={width:100,height:100},s=2,i=e.width/2+s,n=e.height/2+s,r=240,o={min:5,max:10},a={min:.875,max:1.875},h=.5,l=1.5,c=4,m={min:12.5,max:22.5},u={min:1.5,max:2.75},p=Math.floor(r*.7),y=Ks(),x=new f.MeshLambertMaterial({color:4539717,flatShading:!0,side:f.DoubleSide}),g=new f.MeshLambertMaterial({color:3487029,flatShading:!0,side:f.DoubleSide});ei(d,y,g,{halfWidth:i+c,halfHeight:n+c,spikeCount:p,spikeHeight:m,spikeWidth:u,embeddingDepth:h*1.5,positionJitter:l*.7}),ti(d,y,x,{halfWidth:i,halfHeight:n,spikeCount:r,spikeHeight:o,spikeWidth:a,embeddingDepth:h,positionJitter:l})}function Ks(){const d=new f.BufferGeometry,t=new Float32Array([-.5,0,-.5,.5,0,-.5,0,0,.5,0,1,0]),e=[0,3,1,1,3,2,2,3,0,0,1,2];return d.setAttribute("position",new f.BufferAttribute(t,3)),d.setIndex(e),d.computeVertexNormals(),d}function ti(d,t,e,s){const{halfWidth:i,halfHeight:n,spikeCount:r,spikeHeight:o,spikeWidth:a,embeddingDepth:h,positionJitter:l}=s,c=2*(i*2+n*2),m=r/c,u=Math.floor(i*2*m),p=Math.floor(n*2*m);vt(d,t,e,-52,n,i,n,u,o,a,h,l,Math.PI),vt(d,t,e,-52,-52,i,-52,u,o,a,h,l,0),vt(d,t,e,-52,-52,-52,n,p,o,a,h,l,Math.PI*1.5),vt(d,t,e,i,-52,i,n,p,o,a,h,l,Math.PI*.5)}function vt(d,t,e,s,i,n,r,o,a,h,l,c,m){for(let u=0;u<=o*2;u++){const p=u/(o*2);let y=s+(n-s)*p,x=i+(r-i)*p;const g=u%2===0,S=Math.atan2(r-i,n-s)+Math.PI/2;let C;g?C=(Math.random()-.5)*c:C=(Math.random()-.5)*(c*.8)+c*.3,y+=Math.cos(S)*C,x+=Math.sin(S)*C;let _,M;g?(_=Math.random()*(a.max-a.min)+a.min,M=Math.random()*(h.max-h.min)+h.min):(_=Math.random()*(a.max-a.min)*.7+a.min*.9,M=Math.random()*(h.max-h.min)*.7+h.min*.9);const b=new f.Mesh(t,e);b.position.set(y,-.5,x),b.scale.set(M,_,M);const w=m+(Math.random()-.5)*.5;b.rotation.y=w,b.rotation.x=(Math.random()-.5)*.2,b.rotation.z=(Math.random()-.5)*.2,d.add(b)}}function ei(d,t,e,s){const{halfWidth:i,halfHeight:n,spikeCount:r,spikeHeight:o,spikeWidth:a,embeddingDepth:h,positionJitter:l}=s,c=2*(i*2+n*2),m=r/c,u=Math.floor(i*2*m),p=Math.floor(n*2*m);At(d,t,e,-56,n,i,n,u,o,a,h,l,Math.PI),At(d,t,e,-56,-56,i,-56,u,o,a,h,l,0),At(d,t,e,-56,-56,-56,n,p,o,a,h,l,Math.PI*1.5),At(d,t,e,i,-56,i,n,p,o,a,h,l,Math.PI*.5)}function At(d,t,e,s,i,n,r,o,a,h,l,c,m){const u={x:n-s,z:r-i},p=Math.sqrt(u.x*u.x+u.z*u.z),y={x:u.x/p,z:u.z/p},x={x:y.z,z:-y.x};for(let g=0;g<=o;g++){const S=g/o,C=s+(n-s)*S,_=i+(r-i)*S;let M=C+x.x*3,b=_+x.z*3;const w=(Math.random()-.5)*c,O=(Math.random()-.5)*c;M+=w,b+=O;const H=Math.random()*(a.max-a.min)+a.min,I=Math.random()*(h.max-h.min)+h.min,v=new f.Mesh(t,e);v.position.set(M,-.75,b),v.scale.set(I,H,I);const B=m+(Math.random()-.5)*.6;v.rotation.y=B,v.rotation.x=(Math.random()-.5)*.2,v.rotation.z=(Math.random()-.5)*.2,d.add(v)}}class si{constructor(){this.container=null,this.initialized=!1}initialize(){this.initialized||(this.container=document.createElement("div"),this.container.id="game-over-screen",this.container.style.position="fixed",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",this.container.style.height="100%",this.container.style.backgroundColor="black",this.container.style.zIndex="2000",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.justifyContent="center",this.container.style.alignItems="center",this.container.style.opacity="0",this.container.style.transition="opacity 0.5s ease",this.gameOverText=document.createElement("h1"),this.gameOverText.textContent="Game Over",this.gameOverText.style.color="white",this.gameOverText.style.fontFamily="monospace",this.gameOverText.style.fontSize="48px",this.gameOverText.style.marginBottom="20px",this.gameOverText.style.opacity="0",this.gameOverText.style.transition="opacity 0.5s ease",this.scoreText=document.createElement("p"),this.scoreText.style.color="white",this.scoreText.style.fontFamily="monospace",this.scoreText.style.fontSize="24px",this.scoreText.style.marginBottom="30px",this.scoreText.style.opacity="0",this.scoreText.style.transition="opacity 0.5s ease",this.playAgainButton=document.createElement("button"),this.playAgainButton.textContent="Play Again",this.playAgainButton.style.padding="10px 20px",this.playAgainButton.style.fontSize="18px",this.playAgainButton.style.backgroundColor="transparent",this.playAgainButton.style.color="white",this.playAgainButton.style.border="2px solid white",this.playAgainButton.style.fontFamily="monospace",this.playAgainButton.style.cursor="pointer",this.playAgainButton.style.opacity="0",this.playAgainButton.style.transition="opacity 0.5s ease, background-color 0.2s ease",this.playAgainButton.addEventListener("mouseover",()=>{this.playAgainButton.style.backgroundColor="rgba(255, 255, 255, 0.2)"}),this.playAgainButton.addEventListener("mouseout",()=>{this.playAgainButton.style.backgroundColor="transparent"}),this.playAgainButton.addEventListener("click",()=>{this.hide(),window.location.reload()}),this.container.appendChild(this.gameOverText),this.container.appendChild(this.scoreText),this.container.appendChild(this.playAgainButton),document.body.appendChild(this.container),this.initialized=!0)}show(){this.initialize(),this.scoreText.textContent=`Score: $${k.money}`,this.container.style.opacity="1",setTimeout(()=>{this.gameOverText.style.opacity="1",setTimeout(()=>{this.scoreText.style.opacity="1",setTimeout(()=>{this.playAgainButton.style.opacity="1"},300)},300)},2e3)}hide(){!this.initialized||!this.container||(this.container.style.opacity="0",setTimeout(()=>{this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.initialized=!1},500))}}const ii=new si,R=new f.Scene,Y=new f.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),ot=new f.WebGLRenderer({antialias:!1,powerPreference:"high-performance"});ot.setSize(320,240);ot.setPixelRatio(1);document.body.appendChild(ot.domElement);const fe=new Js(ot,R,Y);ot.domElement.style.width="100vw";ot.domElement.style.height="100vh";const{instructions:ni}=ys(),{controls:P,moveSpeed:ge,keys:U,velocity:Z}=rs(Y,ni);R.add(P.getObject());let dt=new Xs(R,P.getObject().position);console.log("Created merchant machine at start");const xe=["SYSTEM SCAN INITIATED...","Anomaly detected in Sector 7G.","WARNING: Entity proximity increasing.","Memory corruption detected.",`
ERROR: UNKNOWN ORIGIN
SIGNAL LOST...`,"Searching for lost signal...","Atmospheric pressure dropping.","Is anybody out there?","SECURITY ALERT: Perimeter breach.","Running diagnostics..."];function oi(){const d=Math.floor(Math.random()*xe.length);return xe[d]}function ke(){const e=Math.random()*5e3+1e4;setTimeout(()=>{const s=oi();nt.showTerminal(s,6e3),ke()},e)}let qt,Dt;document.addEventListener("gameStart",()=>{console.log("Main.js received gameStart event!"),ke()});document.addEventListener("allDiscsCollected",d=>{console.log("Main.js received allDiscsCollected event!",d.detail)});const Xt=as(R),ri=1;k.setBoundary(Xt.ground,ri);console.log("Player boundaries set to original 100x100 area. Player movement restricted to x: ±50, z: ±50");console.log("Ground size is 150x150, creating an extended visual area that player cannot access");Qs(R,Xt.ground);console.log("Setting up collectibles and Lost Disc...");(async()=>{try{qt=(await Hs(R)).checkDiscCollection,console.log("Discs setup complete"),Dt=await Ds(R),console.log("Lost Disc system initialized")}catch(d){console.error("Error setting up game components:",d)}})();Gs(R,d=>!dt||!Ce(d,dt.getPosition()));const ai=15,hi={minX:-50,maxX:50,minZ:-50,maxZ:50},li=8;Ys(R,ai,hi,li,Y.position.y,d=>!dt||!Ce(d,dt.getPosition()));ms(Y);Y.position.y=1.7;window.addEventListener("resize",()=>{Y.aspect=window.innerWidth/window.innerHeight,Y.updateProjectionMatrix(),ot.setSize(320,240)});const ci=Zs(R);k.setMonsterReference(ci);U.g=!1;U.h=!1;document.addEventListener("keydown",d=>{d.key.toLowerCase()==="g"&&(U.g=!0,console.log("🎮 G key pressed - Attempting to spawn monster..."),k.spawnMonster()),d.key.toLowerCase()==="h"&&(U.h=!0,console.log("🎮 H key pressed - Debug spawning Lost Disc..."),document.dispatchEvent(new CustomEvent("spawnLostDisc")))});document.addEventListener("keyup",d=>{d.key.toLowerCase()==="g"&&(U.g=!1),d.key.toLowerCase()==="h"&&(U.h=!1)});document.addEventListener("lostDiscEnvironmentChange",()=>{console.log("Changing environment for Lost Disc appearance"),hs(R,Xt)});document.addEventListener("spawnMonster",()=>{console.log("Monster spawn event received - Spawning monster"),k.spawnMonster()});document.addEventListener("gameOver",()=>{console.log("Game over event received"),ze=!1,P.isLocked&&P.unlock(),ii.show()});let ze=!0;function Ee(){if(requestAnimationFrame(Ee),!ze){fe.render();return}const d=Date.now()*.001;if(P.isLocked){Z.x=0,Z.z=0,U.w&&(Z.z=ge),U.s&&(Z.z=-.15),U.a&&(Z.x=-.15),U.d&&(Z.x=ge),P.moveRight(Z.x),P.moveForward(Z.z);const t=P.getObject();k.updatePosition(t.position.x,t.position.y,t.position.z),t.position.x=k.position.x,t.position.z=k.position.z;const e=new f.Vector3;Y.getWorldDirection(e),k.updateForwardDirection(e.x,e.y,e.z),Y.position.y=1.7+Math.sin(d*2)*.01,qt&&qt(P.getObject().position),Dt&&Dt.checkLostDiscCollection&&Dt.checkLostDiscCollection(P.getObject().position),dt&&dt.checkPlayerProximity(P.getObject().position)}js(d),_e(d),fe.render()}Ee();
